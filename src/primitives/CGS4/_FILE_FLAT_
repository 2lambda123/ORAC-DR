=head1 NAME					-*-perl-*-

FILE_FLAT

=head1 DESCRIPTION

File an observation as the current flat.

=cut

if ($Frm->nfiles == 1) {
  
  unless ($Frm->hdr->{'OBSTYPE'} eq 'FLAT') {
    orac_warn("This is not a flat frame! Are you running the wrong recipe?\n");
    orac_warn("I'll assume you know what you're doing!\n");
  };

  # Obtain the current frame's number.
  my $obsnum = $Frm->hdr( "OBSNUM" );
  
  # Take a copy of the current frame using a more-identifiable name.
  my $in = $Frm->file;
  my $flat = "flat_" . $obsnum;
  $Mon{ "ndfpack_mon" }->obeyw( "ndfcopy", "in=$in out=$flat" );
  
  # Store the flat as the current frame.
  $Frm->file( $flat );
  
  # File the current frame as the current flat.
  $Cal->flat( $Frm->file );
  
  # Report the processing status.
  orac_print $Frm->file . " filed as the current flat\n";
  
  # Add this frame to the index of flat frames.
  $Cal->flatindex->add( $Frm->file, $Frm->hdr );
  
  # Report the processing status.
  orac_print $Frm->file . " added to index file\n";
  
} else {
  
  orac_warn("Flat frame has not been coadded! Not filed as calibration\n");


}
