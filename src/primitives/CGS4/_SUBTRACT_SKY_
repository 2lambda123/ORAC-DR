# _SUBTRACT_SKY_          -*- perl -*-
#

=head1 NAME

_SUBTRACT_SKY_ - subtract the sky frame from the current frame

=head1 DESCRIPTION

This primitive subtracts the sky from the current frame.
Nothing happens if the observation is of type SKY.

=head1 OUTPUT FILES

The following files are created:

=over 4

=item C<_ss>

Deskyed file.

=back

=head1 EXTERNAL TASKS

The following external tasks are used:

=over 4

=item KAPPA

C<sub>

=head1 AUTHOR

Frossie Economou

=cut

# skip if actually a SKY

#unless ($Frm->hdr->{OBSTYPE} eq 'SKY') {
  

    
    my $sky =  $Cal->sky;
    orac_print "\nOrac says: Sky frame $sky will be used\n";
    
    foreach my $i (1..$Frm->nfiles) {
      
      # Generate the input and output filenames.
      my ($in,$out) = $Frm->inout("_ss",$i);
      
      # Add the mask which comprises bad pixels and zero elsewhere.
      $Mon{"kappa_mon"}->obeyw("sub","in1=$in out=$out in2=$sky title=$out");
      
      # Report the processing status.
      orac_print "Orac says: $in to $out: Sky subtracted\n";
      
      # Record the new file name in the frame object.
      $Frm->file($i,$out);		# obligatory update step
      
    };
    
    

#}
