# -*-perl-*-

=head1 NAME

COADD_MULTIPLE_EXPOSURES - coadd sub-frames to give one output frame

=head1 DESCRIPTION

Coadds sub-frames via averaging to give a single output frame.

=head1 PARAMETERS

=over 4

none

=back

=head1 ORAC

=head2 Engines referenced

KAPPA

=head2 Tasks called

=over 4

=item kappa_mon

cdiv, maths

=back

=head2 Objects addressed

$Frm

=head2 REVISION

  $Id$

=head1 AUTHOR

frossie@jach.hawaii.edu

=cut

my $nfiles = $Frm->nfiles;

if($nfiles != 1) {

  # generate list of files for 'makemos'
  my $tmp = new ORAC::TempFile;
  foreach my $i (1..$nfiles) {
    print {$tmp->handle} $Frm->file($i) . "\n";
  }
  $tmp->handle->close;

  # generate name of output file
  $Frm->files($Frm->file);
  my ($in,$out) = $Frm->inout("_co");

  # average the files together using 'makemos'
  my $mosargs = "in=^" . $Frm->file . " noscale nousevar nozero method=mean logto=neither logfile=!";
  $Mon{'ccdpack_reg'}->obeyw("makemos","$mosargs out=$out");

  # update $Frm object
  $Frm->file($out);
  $Frm->mergehdr;
  
  $Display->display_data($Frm) if defined $Display;
  
  # print congratulatory message
  orac_print ("Frames coadded into $out\n");
}
