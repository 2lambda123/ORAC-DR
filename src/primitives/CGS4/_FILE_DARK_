=head1 NAME					-*-perl-*-

FILE_DARK

=head1 DESCRIPTION

File an observation as the current dark.

=cut

if ($Frm->nfiles == 1) {
  
  unless ($Frm->hdr->{'OBSTYPE'} eq 'DARK') {
    orac_warn("This is not a dark frame! Are you running the wrong recipe?\n");
    orac_warn("I'll assume you know what you're doing!\n");
  };

  # Obtain the current frame's number.
  my $obsnum = $Frm->hdr( "OBSNUM" );
  
  # Take a copy of the current frame using a more-identifiable name.
  my $in = $Frm->file;
  my $dark = "dark_" . $obsnum;
  $Mon{ "ndfpack_mon" }->obeyw( "ndfcopy", "in=$in out=$dark" );
  
  # Store the dark as the current frame.
  $Frm->file( $dark );
  
  # File the current frame as the current dark.
  $Cal->dark( $Frm->file );
  
  # Report the processing status.
  orac_print $Frm->file . " filed as the current dark\n";
  
  # Add this frame to the index of dark frames.
  $Cal->darkindex->add( $Frm->file, $Frm->hdr );
  
  # Report the processing status.
  orac_print $Frm->file . " added to index file\n";
  
} else {
  
  orac_warn("Dark frame has not been coadded! Not filed as calibration\n");


}
