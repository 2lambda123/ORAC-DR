# _SUBTRACT_BIAS_          -*- perl -*-
#

=head1 NAME

_SUBTRACT_BIAS_ - subtract the bias frame from the current frame

=head1 DESCRIPTION

This primitive subtracts the bias from the current frame.
Nothing happens if the observation is of type ND_STARE.

=head1 OUTPUT FILES

The following files are created:

=over 4

=item C<_db>

Debiased file.

=back

=head1 EXTERNAL TASKS

The following external tasks are used:

=over 4

=item KAPPA

C<sub>

=head1 AUTHOR

Frossie Economou

=cut

# skip if actually a BIAS

unless ($Frm->hdr->{OBSTYPE} eq 'BIAS') {
  
  if ($Frm->hdr->{MODE} ne 'ND_STARE') {
    
    my $bias =  $Cal->bias;
    orac_print "\nOrac says: Bias frame $bias will be used\n";
    
    foreach my $i (1..$Frm->nfiles) {
      
      # Generate the input and output filenames.
      my ($in,$out) = $Frm->inout("_db",$i);
      
      # Add the mask which comprises bad pixels and zero elsewhere.
      $Mon{"kappa_mon"}->obeyw("sub","in1=$in out=$out in2=$bias title=$out");
      
      # Report the processing status.
      orac_print "Orac says: $in to $out: Bias subtracted\n";
      
      # Record the new file name in the frame object.
      $Frm->file($i,$out);		# obligatory update step
      
    };
    
    
  } else {
    
    orac_print "ND_STARE observation, no bias subtracted\n";

}


}
