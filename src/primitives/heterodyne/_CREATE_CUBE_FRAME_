# -*-perl-*-

=head1 NAME

_CREATE_CUBE_FRAME_ -- Create a cube from a time-series ACSIS
observation and stuff it in the Frm object.

=head1 DESCRIPTION

This primitive takes a time-series ACSIS cube and, using
SMURF/MAKECUBE, transforms it into a spatial/spectral cube.

=head1 ARGUMENTS

=over 4

None.

=back

=head1 NOTES

=over 4

=itme *

This primitive is suitable for ACSIS.

=item *

The pixel scale of the output cube is currently set to 6 arcseconds.

=back

=head1 OUTPUT DATA

=over 4

=item *

A cube whose filename is of the form aYYYYMMDD_NNNNN_SS_MMMM_cube.sdf,
where YYYYMMDD is the UT date, NNNN is the zero-padded observation
number, SS is the zero-padded susbystem number, and MMMM is the
zero-padded sub-scan number.

=back

=head1 TASKS

SMURF: MAKECUBE.

=head1 REQUIRED PERL MODULES

None.

=head1 AUTHORS

Brad Cavanagh <b.cavanagh@jach.hawaii.edu>

=head1 COPYRIGHT

Copyright (C) 2006 Particle Physics and Astronomy Research
Council.  All Rights Reserved.

=cut

my $out;
my @files;

# Create a list of input images.
my $inlist = new ORAC::TempFile( OPEN => 1,
                                 SUFFIX => '.lis' );
my $inlist_fh = $inlist->handle;

foreach my $i ( 1..$Frm->nfiles ) {

  my ( $in, $tmp ) = $Frm->inout( "_cube", $i );

  if( $i == 1 ) {
    $out = $tmp;
  }

  print $inlist_fh "$in\n";
  push @files, $in;
}

$inlist->handle->close;

# Set up the parameters to MAKECUBE.
my $params = "in='^" . $inlist->file . "' out=$out pixsize=6";

# Tell user what we're doing.
orac_print( "Creating cube from " . join( ", ", @files ) . "..." );

# Run MAKECUBE.
$Mon{'smurf_mon'}->obeyw( "makecube", "$params" );

orac_print( "done.\nCube formed in $out.\n" );

# Update the Frm object.
$Frm->file( $out );

# Tidy-up output.
orac_print "\n";
