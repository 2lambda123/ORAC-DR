=head1 NAME

_WRITE_NOISESTATS_LOG_

=head1 DESCRIPTION

This primitive writes the log file of the noise statistics comprising
columns for the file name, the median Tsys, the array RMS, and the map
RMS (from the baseline noise).  The log file takes the form of a table
with labelled columns.

=head1 ARGUMENTS

=over 4

=item OBJ = ORAC::Frame/ORAC::Group object (Given)

The ORAC::Frame or ORAC::Group object from which the noise
information will be taken.  [current ORAC::Frame object]

=back

=head1 NOTES

=over 4

=item *

It creates an ORAC-DR log file to record the results.  Thus for multiple
processing, only the additional statistics are appended.

=item *

The information is obtained from the C<MEDTSYS>, C<RMS_VAR>, and
C<RMS_MAP> headers.

=back

=head1 OUTPUT DATA

=over 4

=item *

The log file C<$ORAC_DATA_OUT/log.noisestats>.

=back

=head1 TASKS

None.

=head1 REQUIRED PERL MODULES

None.

=head1 AUTHORS

Malcolm J. Currie E<lt>mjc@jach.hawaii.eduE<gt>

=head1 COPYRIGHT

Copyright (C) 2014 Science and Technology Facilities Council.  All
Rights Reserved.

=cut

# Handle arguments.
my $Obj = get_prim_arg( $_PRIM_ARGS_, "OBJ", $Frm );

# Start a log file.
my $log = new ORAC::LogFile( 'log.noisestats' );

# Write the header if not already present.
my $fileformat = "A30";
my $filehead =  pack( $fileformat, "File" );
my $header = "$filehead   median Tsys   RMS_baseline    RMS_mean";
$log->header( $header );

# Obtain the relevant parameters.
my $name = pack( $fileformat, $Obj->file );
my $medtsys = defined( $Obj->hdr( "MEDTSYS" ) ) ?
              sprintf( "%12.3f", $Obj->hdr( "MEDTSYS" ) ) :
              " " x 12;

my $rms_map = defined( $Obj->uhdr( "RMS_MAP" ) ) ?
              sprintf( "%14.4f", $Obj->uhdr( "RMS_MAP" ) ) :
              " " x 14;

my $rms_mean = " " x 14;
if ( defined( $Obj->uhdr( "RMS_MEAN" ) ) ) {
   $rms_mean = sprintf( "%14.4f", $Obj->uhdr( "RMS_MEAN" ) );
   $rms_mean = " " x 14 if ( $rms_mean == 0 );
}

# Write them to a new line in the log file.
my $logentry ="$name$medtsys$rms_map$rms_mean";
$log->addentry( $logentry );
