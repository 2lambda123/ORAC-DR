# -*-perl-*-

=head1 NAME

_REMOVE_BASELINE_

=head1 DESCRIPTION

This primitive removes the baseline from each spectrum in a cube,
using spectral windows that are assumed to be free of spectral lines.

=head1 ARGUMENTS

=over 4

=item ORDER = INTEGER (Given)

The order of the fit to use for the baseline. Zero (the default) is a
constant, one is linear, etc. [0]

=back

=head1 NOTES

=over 4

=item *

This primitive is suitable for ACSIS observations.

=item *

This primitive is suitable for spectral line observations. Removing
the baseline from continuum observations may not be desirable.

=back

=head1 OUTPUT DATA

=over 4

=back

=head1 TASKS

KAPPA: MFITTREND.

=head1 REQUIRED PERL MODULES

None.

=head1 AUTHORS

Brad Cavanagh E<lt>b.cavanagh@jach.hawaii.eduE<gt>

=head1 COPYRIGHT

Copyright (C) 2007 Particle Physics and Astronomy Research
Council.  All Rights Reserved.

=cut

# Deal with arguments.
my $order = ( defined( $_REMOVE_BASELINE_{ORDER} ) ?
              $_REMOVE_BASELINE_{ORDER}            :
              0 );

my ( $in, $out ) = $Frm->inout( "_bl" );

orac_print "Removing baseline from $in using a ${order}-order polynomial...";

# Set up parameters for MFITTREND; it uses the AUTO mode and a
# constant baseline.
my $params = "in=$in out=$out auto=true modifyin=false subtract=true";
$params   .= " order=$order axis=3";

# Run MFITTREND.
$Mon{'kappa_mon'}->obeyw( "mfittrend", "$params" );

# Report to user.
orac_print "done.\n";
orac_print "Baselined cube stored in $out.\n";

# Update Frame object;
$Frm->file( $out );

# Tidy-up output.
orac_print "\n";
