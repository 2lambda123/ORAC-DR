=head1 NAME                                     -*-perl-*-

_ALIGN_ - Perform alignment for each f slice i.e. each file in a frame.

=head1 DESCRIPTION

Uses wcsalign to align each cube slice within a frame, prior to a frame mosaic.

=head1 ARGUMENTS

=over

=item 4

=item ENCODING

=back

=head1 AUTHOR

Jamie Leech E<lt>j.leech@jach.hawaii.eduE<gt>

=head1 COPYRIGHT

Copyright (C) 1998-2002 Particle Physics and Astronomy Research
Council. All Rights Reserved.

=cut

my $infile;
my $outfile;
my $i=0;

# Create a list of input and output images.
my $inputlist = "inlist.list$$";
my $outputlist = "outlist.list$$";
unlink( $inputlist, $outputlist );

open( my $fh_inlist, ">$inputlist" ) ||
    orac_throw "Unable to open $inputlist to create a list of spectra to align. Error: $!\n";
open( my $fh_outlist, ">$outputlist" ) ||
    orac_throw "Unable to open $outputlist to create a list of spectra to align. Error: $!\n";

foreach my $file ($Frm->files) {

       $outfile=$file."_align";
       $infile=$file;

       print $fh_inlist $infile, "\n";
       print $fh_outlist $outfile, "\n";

       orac_print "$infile --> $outfile \n";

       $Frm->file( $i+1, $outfile );

       $i++;
}

# Close the filehandles.
close( $fh_inlist );
close( $fh_outlist );

orac_print "The input list is $inputlist \n";
orac_print "The output list is $outputlist \n";

my $param1 = "in='^$inputlist' out='^$outputlist' lbnd=! ubnd=! ref=! accept";

$Mon{'kappa_mon'}->obeyw( "wcsalign", "$param1" );

# Remove the filelists.
unlink( $inputlist, $outputlist );




