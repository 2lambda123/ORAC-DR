#! -*-perl-*-

=head1 NAME

_REMOVE_SKY_POLY_ - Removes the polynomial fit to the sky values

=head1 SYNOPSIS

  _REMOVE_SKY_POLY_

=head1 DESCRIPTION

Subtracts a mean sky value from an uncalibrated image. An error is
generated if this primitive is run on calibrated data since it is
assumed that this step will have been done already before calibration.

This primitive is an alternative to _REMOVE_PLANE_FROM_IMAGE_.

This is a Frame operation and should be used before group operations.

=head1 External Tasks

The following external tasks are used:

=over 4

=item SMURF

C<REMSKY>

=back

=head1 FILES

Creates an output file with a C<_sky> extension.

=head1 KNOWN ISSUES

Assumes that this step should be done before calibration although it's
a bit late to tell the user that it should have been done at an
earlier stage.

=head1 AUTHOR

Andy Gibb E<lt>agg@astro.ubc.caE<gt>

Copyright (C) 2006 the University of British Columbia.  All Rights
Reserved.


=cut

# Loop over files in the Frm object
orac_print "Subtracting per-bolometer polynomial fits\n";
for my $i (1..$Frm->nfiles) {

  my ($in, $out) = $Frm->inout("_sky", $i);
  $Mon{smurf_mon}->obeyw("remsky","in=$in out=$out method=poly");

  # Update file
  $Frm->file($i, $out);

}

orac_print "Polynomial subtraction successful\n";

