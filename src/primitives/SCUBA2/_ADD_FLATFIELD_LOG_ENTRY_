# -*-perl-*-

=head1 NAME

_ADD_FLATFIELD_LOG_ENTRY_ - Write flatfield log entry to disk

=head1 SYNOPSIS

_ADD_FLATFIELD_LOG_ENTRY_ PARAMS=$paramsref

=head1 DESCRIPTION

Write entry to a log file given properties of the responsivities for
the current flatfield solution.

=head1 ARGUMENTS

The following arguments are supported:

=over 4

=item B<PARAMS>

Array reference with list of parameters. It is the user's
responsibility to ensure that the array contains the appropriate
values.

=back

=head1 EXTERNAL TASKS

The following external tasks are used:

=over 4

=item ORAC-DR PRIMITIVES:

_GET_LOG_PARAMETERS_

=back

=head1 NOTES

=over 4

=item *

One entry is written each time this primitive is called. If multiple
files are to be processed, this primitive should be called multiple
times.

=back

=head1 OUTPUT FILES

Creates an output log file called C<log.noise>

=head1 LOGFILE FORMAT

The logfile has the following columns:

=over 4

=item UT

The UT date in C<YYYYMMDD.frac> format.

=item HST

The time of the observation in Hawaii.

=item Obs

The observation number.

=item Subarray

Current subarray

=item Median

Median responsivity

=item Delta

Change in median

=item Mean

Mean responsivity

=item Delta

Change in mean

=item Sigma

Standard deviation of responsivity values

=item Delta

Change in sigma

=item Max

Maximum responsivity

=item Delta

Change in maximum

=item Min

Minimum responsivity

=item Delta

Change in minimum

=item Ngood

Number of good solutions

=item Delta

Change in the number of good solutions

=back

=head1 AUTHOR

Andy Gibb E<lt>agg@astro.ubc.caE<gt>

Copyright (C) 2009 the University of British Columbia.  All Rights
Reserved.

This program is free software; you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation; either version 3 of the License, or (at
your option) any later version.

This program is distributed in the hope that it will be useful, but
WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program; if not, write to the Free Software
Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307,
USA.

=cut

# Read arguments
my $params = get_prim_arg( $_PRIM_ARGS_, "PARAMS", undef );
unless (defined $params) {
  orac_throw("_ADD_FLATFIELD_LOG_ENTRY_: PARAMS must be specified as an argument");
}

# Create new log file if necessary
my $time = gmtime();
my $flatlog = new ORAC::LogFile("log.flatfield");
$flatlog->header("# Responsivity properties log file - created on $time UT",
		"#\n# Delta = (current - previous) values",
		 "# UT                HST   Obs Median Delta Mean Delta Sigma Delta Max Delta Min Delta Ngood Delta",
		"#----------------------------------------------------------------------------------------------------");


# Obtain common parameters but we don't need them all
_GET_LOG_PARAMETERS_ PARLIST=BRIEF
my ( $uttime, $hst, $obsnum, $src, $mode, $filter)
  = @{ $_GET_LOG_PARAMETERS_{PARAMS} };

# Write logfile entry
$flatlog->addentry("$uttime $hst $obsnum ".join(" ",@$params));
