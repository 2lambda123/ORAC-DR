#! -*-perl-*-

=head1 NAME

_REDUCE_PIXSIZE_ - Regrid an image with a smaller pixel size

=head1 DESCRIPTION

This primitive regrids an image onto a grid with a smaller pixel scale
using the KAPPA C<pixdupe> command. It is designed for use with SCUBA2
observing in STARE mode to take account of the undersampling at 450
um. It should be run immediately after mosaicking the subarray images
together (though in practice it is called from within
_ALIGN_AND_MOSAIC_SUBARRAY_).

The user supplies the image name (no default) and the factor which the
pixels are reduced, for which the default is 2. The `extra' pixels
generated by the duplicating the pixels are blanked to allow offset
images to be mosaicked.

=head1 ARGUMENTS

The following arguments are supported:

=over 4

=item FACTOR

The factor by which the pixel scale should be reduced. Default value is 2.

=item IMAGE

Name of the image to be regridded

=item VERBOSE

Flag to indicate whether informational messages should be given to the
user. Default is true.

=back

=head1 EXTERNAL TASKS

=over 4

=item KAPPA

C<pixdupe>

=back

=head1 RESULTS

An array reference containing the name of the output file.

=head1 FILE SUFFIX

Creates a single output file based on the input file with the suffix
C<_str> (from STare Regrid).

=head1 FUTURE WORK

??

=head1 AUTHOR

Andy Gibb E<lt>agg@astro.ubc.caE<gt>

=head1 COPYRIGHT

Copyright (C) 2005 University of British Columbia. All Rights Reserved.

This program is free software; you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation; either version 3 of the License, or (at
your option) any later version.

This program is distributed in the hope that it will be useful, but
WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program; if not, write to the Free Software
Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307,
USA

=cut

# OK look for parameters:

# Should I be verbose? (default to yes)
my $verbose = (exists $_REDUCE_PIXSIZE_{VERBOSE} &&
               defined $_REDUCE_PIXSIZE_{VERBOSE}) ?
               $_REDUCE_PIXSIZE_{VERBOSE} : 1;

# Image name
my $infile = undef;
if (exists $_REDUCE_PIXSIZE_{IMAGE} && defined $_REDUCE_PIXSIZE_{IMAGE}) {
    $infile = $_REDUCE_PIXSIZE_{IMAGE};
} else {
    # Exit with no file name
    orac_throw "Error: must supply filename to _REDUCE_PIXSIZE_\n";
}

# Scale factor, default = 2
my $factor = (exists $_REDUCE_PIXSIZE_{FACTOR} &&
               defined $_REDUCE_PIXSIZE_{FACTOR}) ?
               $_REDUCE_PIXSIZE_{FACTOR} : 2;

# Set output file as input file but with _str suffix
my $outfile = $Frm->inout("_str"); # STR = STare Regrid

my $params = "in=$infile out=$outfile expand=$factor imask=\[1,1\]";

$Mon{kappa_mon}->obeyw("pixdupe", "$params");

$_REDUCE_PIXSIZE_{OUTFILE} = $outfile;
