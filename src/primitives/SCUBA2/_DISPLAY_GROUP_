# -*-perl-*-

=head1 NAME

_DISPLAY_GROUP_ - Display (optionally) the current group image

=head1 SYNOPSIS

 _DISPLAY_GROUP_

=head1 DESCRIPTION

This primitive asks the display system to display the current group.

=head1 KNOWN ISSUES

Should be replaced by a call to the general ORAC-DR implementation.

=head1 AUTHOR

Tim Jenness E<lt>t.jenness@jach.hawaii.eduE<gt>

=head1 COPYRIGHT

Copyright (C) 2004-2005 Particle Physics and Astronomy Research Council.
All Rights Reserved.

This program is free software; you can redistribute it and/or modify it under
the terms of the GNU General Public License as published by the Free Software
Foundation; either version 3 of the License, or (at your option) any later
version.

This program is distributed in the hope that it will be useful,but WITHOUT ANY
WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A
PARTICULAR PURPOSE. See the GNU General Public License for more details.

You should have received a copy of the GNU General Public License along with
this program; if not, write to the Free Software Foundation, Inc., 59 Temple
Place,Suite 330, Boston, MA  02111-1307, USA

=cut

# Should the variance image also be display?
my $dispvar = (exists $_PRIM_ARGS_->{DISPVAR} &&
	       defined $_PRIM_ARGS_->{DISPVAR}) ?
  $_PRIM_ARGS_->{DISPVAR} : 0;

if ( $Grp->uhdr("NEWIMAGE") ) {

  if ( (defined $Display) && ($Grp->file_exists) ) {
    $Display->display_data( $Grp ) ;

    # If the variance is to be plotted, copy it out to another file
    # and display that
    if ( $dispvar ) {
      my $varfile = $Grp->inout("_var");
#      my $varfile = "groupvar_var";
      my $args = "inp=".$Grp->file." out=$varfile";
      $Mon{hdstools_mon}->obeyw("hcopy","$args");
#      $args = "inp=".$Grp->file.".variance out=$varfile.data_array";
      $args = "inp=$varfile.variance out=$varfile.data_array";
      $Mon{hdstools_mon}->obeyw("hcopy","$args");
      my $realgroupname = $Grp->file;

      # Register variance file as the group file name for display
      # purposes
      $Grp->file($varfile);
      $Display->display_data( $Grp ) if (defined $Display);
      # Reset Group filename
      $Grp->file ($realgroupname);
    }

  }
}

