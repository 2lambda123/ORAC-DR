# _SUBTRACT_DARK_
#
# Subtracts a bias frame
#
# TASK: CCDPACK - CALCOR
#
# This should only be performed on OBJECT frames.
if ($Hdr{OBSTYPE} =~ /OBJECT/) {

# Should also check that the exposure times match.  Just hardwire
# the dark-frame exposure for now.
   if ($Hdr{EXPOSED} =~ /5/) {

# User-accessible mapping and parameters
      $user = "";
#
# Assign other parameters.  Note that the dark is hardwired for the moment.
      $isuffix = ($_SUBTRACT_DARK_{SUFFIX_IN} || "_db");
      $osuffix = ($_SUBTRACT_DARK_{SUFFIX_OUT} || "_dk");
      $header = "in=${main::File}$isuffix cal=${main::Root}9$isuffix out=${main::File}$osuffix";
      $hidden = "expose=1"; 

# Note all dark frames and data frames should have the same exposure time.
# The absolute exposure times do not matter, only the relative times.
# The output files have the same names as the input except the suffices are
# changed to indicate they have been dark subtracted.
      $Mon{"ccdpack_red"}->obeyw("calcor","$header $user $hidden reset accept");
      print "Command was: calcor $header $user $hidden reset accept\n";
#
      print "Orac says: ${main::File} dark subtracted\n";
   };
};
