=head1 NAME

_MEASURE_DARK_CURRENT_ - returns the dark current for a given frame.

=head1 DESCRIPTION

Returns the dark current for a given frame. This primitive first finds
any bad pixels in the frame using the _FIND_BAD_PIXELS_ primitive, then
masks those bad pixels (along with bad pixels found in a current bad
pixel mask). The dark current is then calculated as the unclipped mean
of the current frame, and is reported in ADU.

yy=head1 AUTHOR

Brad Cavanagh <b.cavanagh@jach.hawaii.edu>

=head1 COPYRIGHT

Copyright (C) 1998-2002 Particle Physics and Astronomy Research
Council. All Rights Reserved.

=cut

# Run this primitive if it's time to do so
if ( $Frm->uhdr( "ARRAY_TESTS_MEASURE_DARK_CURRENT" ) ) {

  ( my $in, my $out ) = $Frm->inout( "_at" )

# Determine bad pixels in this frame, and use it and the existing
# bad pixel mask to flag bad pixels in the existing frame
  _FIND_BAD_PIXELS_
  _MASK_BAD_PIXELS_

# Calculate the mean
  my ( $mean, $ORAC_STATUS );
  $Mon{ "kappa_mon" }->obeyw( "stats", "ndf=$in" );
  ( $ORAC_STATUS, $mean ) = $Mon{ "kappa_mon" }->get( "stats", "mean" );

# Return the mean to the user
  orac_print "Dark current is $mean ADU.\n";

}
