#+
# Name:
#    _SET_INTERNAL_HEADERS_
#
# Purpose:
#    Assigns the header information used by imaging recipes to internal headers
#
# Language:
#    Perl5
#
# Description:
#    This primitive creates a set of internal headers independent of
#    the instrument to be used by the imaging recipes.  These headers
#    are translated from the instrument-specific keywords.  There are
#    two sets, those which are common to all instruments (but may not
#    stay so), and instrument-specific sets.  The latter mostly comprise
#    a common set of internal headers
#
# Notes:
#    -  The internal headers created are as follows.  First are the
#    common headers. 
#       ORAC_AIRMASS_START  Airmass at the start of the exposure
#       ORAC_AIRMASS_END    Airmass at the end of the exposure
#       ORAC_DECBASE        Declination at telescope offset 0,0
#       ORAC_FILTER         Primary filter name
#       ORAC_INSTRUMENT     Instrument name: UFTI, IRCAM3, or Michelle
#       ORAC_LBNDX          Readout area, x lower bound
#       ORAC_LBNDY          Readout area, y lower bound
#       ORAC_NOFFSETS       Number of offsets in a jitter (usually one more
#                           than the number of jitter positions)
#       ORAC_OBJECT         Object name
#       ORAC_OBSTYPE        Observation type (e.g. OBJECT, SKY, DARK)
#       ORAC_RABASE         Right Ascension at telescope offset 0,0
#       ORAC_READMODE       Readout mode, e.g. ND_STARE
#       ORAC_ROTATION       Rotation of the chip's y axis with respect
#                           to north, measured anti-clockwise
#       ORAC_SPD_GAIN       Readout speed and type
#       ORAC_UBNDX          Readout area, x upper bound in pixel index.
#       ORAC_UBNDY          Readout area, y upper bound
#       ORAC_WPLANGLE       Polariser waveplate angle
#
#   These are the instrument-specific internal headers.  Ones only applicable
#   to individual instruments are noted by U, I, M in brackets for UFTI,
#   IRCAM, and Michelle respectively.
#       ORAC_DECSCALE       Declination axis plate scale
#       ORAC_DET_BIAS       Detector bias voltage [I]
#       ORAC_EXP_TIME       Exposure time in seconds
#       ORAC_GAIN           Gain: electrons per ADU 
#       ORAC_RASCALE        Right Ascension axis plate scale
#       ORAC_TDECOFF        Declination telescope offset in arcseconds
#       ORAC_TRAOFF         Right Ascension telescope offset in arcseconds
#       ORAC_UTEND          UT end time of the exposure in decimal hours
#       ORAC_UTSTART        UT start time of the exposure in decimal hours
#
# Authors:
#    MJC: Malcolm J. Currie (JAC)
#
# Copyright:
#    Copyright (C) 1998-2001 Particle Physics and Astronomy Research
#    Council.  All Rights Reserved.
#
#-

# Common
# ======

# These headers are common at present but once one is not, it will need to be
# sub-classed by instrument.
    my %common_hdr = (
         ORAC_AIRMASS_START => "AMSTART",
         ORAC_AIRMASS_END => "AMEND",
         ORAC_DECBASE  => "DECBASE",
         ORAC_FILTER   => "FILTER",
         ORAC_INSTRUMENT => "INSTRUME",
         ORAC_LBNDX    => "RDOUT_X1",
         ORAC_LBNDY    => "RDOUT_Y1",
         ORAC_NOFFSETS => "NOFFSETS",
         ORAC_OBJECT   => "OBJECT",
         ORAC_OBSTYPE  => "OBSTYPE",
         ORAC_RABASE   => "RABASE",
         ORAC_READMODE => "MODE",
         ORAC_ROTATION => "CROTA2",
         ORAC_SPD_GAIN => "SPD_GAIN",
         ORAC_UBNDX    => "RDOUT_X2",
         ORAC_UBNDY    => "RDOUT_Y2",
         ORAC_WPLANGLE => "WPLANGLE"
    );

    foreach ( keys( %common_hdr ) ) {
       $Frm->uhdr( $_ => $Frm->hdr( $common_hdr{ "$_" } ) );
    }

# UFTI
# ====
    my %instrument_hdr;
    if ( $Frm->hdr( "INSTRUME" ) =~ /UFTI/ ) {

       %instrument_hdr = (
            ORAC_EXP_TIME  => "EXP_TIME",
            ORAC_DECSCALE  => "CDELT2",
            ORAC_GAIN      => "GAIN",
            ORAC_RASCALE   => "CDELT1",
            ORAC_TDECOFF   => "TDECOFF",
            ORAC_TRAOFF    => "TRAOFF",
            ORAC_UTEND     => "UTEND",
            ORAC_UTSTART   => "UTSTART"
       );

# Provisionally the same as IRCAM, but will change to be more like UFTI.
    } elsif ( $Frm->hdr( "INSTRUME" ) =~ /Michelle/  ) {

       %instrument_hdr = (
            ORAC_DECSCALE  => "PIXELSIZ",
            ORAC_EXP_TIME  => "DEXPTIME",
            ORAC_GAIN      => "DEPERDN",
            ORAC_RASCALE   => "PIXELSIZ",
            ORAC_TDECOFF   => "DECOFF",
            ORAC_TRAOFF    => "RAOFF",
            ORAC_UTEND     => "RUTEND",
            ORAC_UTSTART   => "RUTSTART"
       );

# Allow for the time when the IRCAM name was gibberish.
    } elsif ( $Frm->hdr( "INSTRUME" ) =~ /IRCAM/ ||
              $Frm->hdr( "INSTRUME" )  =~ /Xi/ ) {

       %instrument_hdr = (
            ORAC_DECSCALE  => "PIXELSIZ",
            ORAC_DET_BIAS  => "DET_BIAS",
            ORAC_EXP_TIME  => "DEXPTIME",
            ORAC_GAIN      => "DEPERDN",
            ORAC_RASCALE   => "PIXELSIZ",
            ORAC_TDECOFF   => "DECOFF",
            ORAC_TRAOFF    => "RAOFF",
            ORAC_UTEND     => "RUTEND",
            ORAC_UTSTART   => "RUTSTART"
       );
    }

    foreach ( keys( %instrument_hdr ) ) {
       $Frm->uhdr( $_ => $Frm->hdr( $instrument_hdr{ "$_" } ) );
    }

# Podule
# ======

=head1 NAME

_SET_INTERNAL_HEADERS_ -- Assigns the header information used by imaging recipes to internal headers

=head1 DESCRIPTION

This primitive creates a set of internal headers independent of
the instrument to be used by the imaging recipes.  These headers
are translated from the instrument-specific keywords.  There are
two sets, those which are common to all instruments (but may not
stay so), and instrument-specific sets.  The latter mostly comprise
a common set of internal headers

=head1 NOTES

=over 4

=item *

The internal headers created are as follows.  First are the
common headers. 

=over 4

   ORAC_AIRMASS_START  Airmass at the start of the exposure
   ORAC_AIRMASS_END    Airmass at the end of the exposure
   ORAC_DECBASE        Declination at telescope offset 0,0
   ORAC_FILTER         Primary filter name
   ORAC_INSTRUMENT     Instrument name: UFTI, IRCAM3, or Michelle
   ORAC_LBNDX          Readout area, x lower bound
   ORAC_LBNDY          Readout area, y lower bound
   ORAC_NOFFSETS       Number of offsets in a jitter (usually one more
                       than the number of jitter positions)
   ORAC_OBJECT         Object name
   ORAC_OBSTYPE        Observation type (e.g. OBJECT, SKY, DARK)
   ORAC_RABASE         Right Ascension at telescope offset 0,0
   ORAC_READMODE       Readout mode, e.g. ND_STARE
   ORAC_ROTATION       Rotation of the chip's y axis with respect
                       to north, measured anti-clockwise
   ORAC_SPD_GAIN       Readout speed and type
   ORAC_UBNDX          Readout area, x upper bound in pixel index.
   ORAC_UBNDY          Readout area, y upper bound
   ORAC_WPLANGLE       Polariser waveplate angle

=back

These are the instrument-specific internal headers.  Ones only applicable
to individual instruments are noted by U, I, M in brackets for UFTI,
IRCAM, and Michelle respectively.

=over 4

   ORAC_DECSCALE       Declination axis plate scale
   ORAC_DET_BIAS       Detector bias voltage [I]
   ORAC_EXP_TIME       Exposure time in seconds
   ORAC_GAIN           Gain: electrons per ADU 
   ORAC_RASCALE        Right Ascension axis plate scale
   ORAC_TDECOFF        Declination telescope offset in arcseconds
   ORAC_TRAOFF         Right Ascension telescope offset in arcseconds
   ORAC_UTEND          UT end time of the exposure in decimal hours
   ORAC_UTSTART        UT start time of the exposure in decimal hours

=back

=back

=head1 AUTHORS

MJC: Malcolm J. Currie (JAC)

=head1 COPYRIGHT

Copyright (C) 1998-2001 Particle Physics and Astronomy Research
Council.  All Rights Reserved.

=cut
