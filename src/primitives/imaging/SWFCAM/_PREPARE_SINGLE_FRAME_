# -*-perl-*-

=head1 NAME

_PREPARE_SINGLE_FRAME_ -- Performs preparatory data-reduction tasks for SWFCAM.

=head1 DESCRIPTION

This primitive does the preparatory work for recipes used by
WFCAM when reduced with Starlink software.  It first masks bad pixels.  It
can create a variance array using the readout noise, add photon
noise to the variance, apply a non-linearity correction to
differenced post-pre exposures and create a valid WCS.  What is
actually performed depends on steering headers.

=head1 NOTES

The functions are performed by other primitives:
L<_MASK_BAD_PIXELS|_MASK_BAD_PIXELS>,
L<_ADD_READNOISE_VARIANCE_|_ADD_READNOISE_VARIANCE>,
L<_ADD_POISSON_VARIANCE_|_ADD_POISSON_VARIANCE_>,
L<_CORRECT_NONLINEARITY_PRE_POST_|_CORRECT_NONLINEARITY_PRE_POST_>, and
L<_CREATE_WCS_|_CREATE_WCS_>.

=head1 OUTPUT DATA

See the primitives mentioned in the Notes.

=head1 AUTHORS

MJC: Malcolm J. Currie (JAC, Starlink)
BC: Brad Cavanagh (JAC)

=head1 COPYRIGHT

Copyright (C) 2001--2005 Particle Physics and Astronomy Research
Council.  All Rights Reserved.

=cut

# Apply the bad-pixel mask.  Note that this must come first to preserve
# any variance information.  In theory it should not lose variance
# merely applying a mask, but in practice the method use does.
    _MASK_BAD_PIXELS_

# Create a variance array with the readout noise.
    _ADD_READNOISE_VARIANCE_

# Add photon noise to the earlier variance.
    _ADD_POISSON_VARIANCE_

# Difference data where there are a pre-exposure and post-exposure
# images to form a simple NDF.
    _DIFFERENCE_PRE_POST_

# Apply non-linearity correction to the differenced pre-exposure and
# post-exposure images.  Applying the correction here does mean a slight
# underestimate of the data errors, but the available correction are
# for after the subtraction.
    _CORRECT_NONLINEARITY_PRE_POST_

# Create the WCS, if needed.
    _CREATE_WCS_

