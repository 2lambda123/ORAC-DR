#+
# Name:
#    _DEFINE_DISTORTION_TRANSFORMATION_
#
# Purpose:
#    Creates the WCS mappings for ISAAC field-distortion correction.
#
# Language:
#    Perl5
#
# Description:
#    This primitive defines the field-distortion mapping for the
#    current frame, using the relationships stored in two `calibration'
#    files.  It creates a new WCS domain called ISAAC_DISTORTION within
#    the frame.
#
# Notes:
#    -  This primitive is suitable for ISAAC in imaging mode.
#    -  The distortion mapping comes from the ISAAC "Known Problems"
#    web page: http://www.eso.org/instruments/isaac/problems_tips.html.
#
# Tasks:
#    KAPPA: WCSADD.
#
# Authors:
#    MJC: Malcolm J. Currie (Starlink)
#
# Copyright:
#    Copyright (C) 2003 Particle Physics and Astronomy Research
#    Council.  All Rights Reserved.
#
#-

# For OS-independent filename creation.
    use File::Spec;

# Open the faint-standards file and store its records in an array.
    my $path = $ENV{ "ORAC_DATA_CAL" };
    my $forexp = "^" . File::Spec->catfile( $path, "forward_distortion.lis" );
    my $invexp = "^" . File::Spec->catfile( $path, "inverse_distortion.lis" );

    my $ndf = $Frm->file;
    my $param1 = "maptype=math frame=grid domain=ISAAC_DISTORTION ndf=$ndf";
    my $param2 = "forexp=$forexp invexp=$invexp frmtype=Frame";
    $Mon{ "ndfpack_mon" }->obeyw( "wcsadd", "$param1 $param2 accept" );

# Report the status.
    orac_print "Distortion transformation created in $ndf\n";

# Podule
# ======

=head1 NAME

_DEFINE_DISTORTION_TRANSFORMATION_ -- Creates the WCS mappings for ISAAC field-distortion correction.

=head1 DESCRIPTION

This primitive defines the field-distortion mapping for the current
frame, using the relationships stored in two `calibration' files.  It
creates a new WCS domain called ISAAC_DISTORTION within the frame.

=head1 NOTES

=over 4

=item *

This primitive is suitable for ISAAC in imaging mode.

=item *

The distortion mapping comes from the ISAAC "Known Problems"
web page: http://www.eso.org/instruments/isaac/problems_tips.html.

=back

=head1 TASKS

KAPPA: WCSADD.

=head1 AUTHORS

MJC: Malcolm J. Currie (Starlink)

=head1 COPYRIGHT

Copyright (C) 2003 Particle Physics and Astronomy Research
Council.  All Rights Reserved.

=cut
