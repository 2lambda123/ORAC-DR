    # Grab some info

    my $outf = $_FLATCOMBINE_{OUT};
    my $masking = $_FLATCOMBINE_{MASK};

    # Get some stats

    foreach my $frm ($Grp->allmembers) {
        my $Frm = $frm;
        _IMSTAT_ HDRUP=1
    }
    _ICSCALE_

    # Get the readnoise...

    my $readnoise = $Cal->readnoise;

    # Create a temporary file with the input file list in it...

    my ($errmsg,$retval);
    my $tmpfil = ORAC::TempFile->new;
    my $fh = $tmpfil->handle;
    foreach my $fr ($Grp->allmembers) {
        print $fh $fr->file,"\n";
        $retval = cir_update_hdr($fr->file,"READNOIS","FLOAT",$readnoise,
            "Current estimate of read noise",$errmsg);
    }
    $fh->close;

    # Get some header keywords

    my $readkey = "READNOIS";
    my $gainkey = $Frm->hdrkeys("GAIN");
    my $expkey = $Frm->hdrkeys("EXPOSURE_TIME");

    # Do the combination

    my $bpmflag;
    $bpmflag = ($masking ? USEBPM : NOBPM);
    $retval = cir_imcombine($tmpfil->file,$outf,"","CIR_OPM",MEDIANCALC,0,1,0,
        $bpmflag,REJPOISSON,1,1,1,3.0,3.0,$readkey,$gainkey,$expkey,$errmsg);
    if ($retval != CIR_OK) {
        orac_throw("CIR_IMCOMBINE: failed in _FLATCOMBINE_\n$errmsg\n");
    }

    # Tidy up

    $tmpfil->DESTROY;

