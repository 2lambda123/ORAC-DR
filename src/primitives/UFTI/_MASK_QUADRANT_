#+
# Name:
#    _MASK_QUADRANT_
#
# Purpose:
#    Masks a quadrant of a frame.
#
# Language:
#    Perl5
#
# Description:
#    This primitive masks a quadrant of the current frame.  The
#    chosen quadrant depends on the sense of the telescope offsets.
#    It reports a successful operation, the quadrant masked, and the
#    frames concerned.
#
# Notes:
#    -  This primitive is suitable for both UFTI and IRCAM.
#    Instrument-specific headers are obtained where appropriate.
#    -  Processing only occurs for object frames.
#    -  The masked image can be displayed.
#    -  The frame title is "X is quadrant masked", where X specifies
#    the quadrant.
#    -  It uses the four ARD files produced by primitive
#    _DEFINE_QUADRANT_MASKS.
#
# Output Data:
#    -  Quadrant-masked frame inheriting the frame's name but with the
#    _qm suffix.
#
# Tasks:
#    KAPPA: ARDMASK.
#
# Authors:
#    MJC: Malcolm J. Currie (JAC)
#
# Copyright:
#    Copyright (C) 1998-2000 Particle Physics and Astronomy Research
#    Council.  All Rights Reserved.
#
#-

# Test whether or not this is an object frame.
    if ( $Frm->hdr( "OBSTYPE" ) eq "OBJECT" ) {

# Determine the telescope offsets.  Here positive offset corresponds
# to the west and south (right and bottom) quadrant.
       my ( $bottom, $right, $maskfile, $quad );
       if ( $Frm->hdr( "INSTRUME" ) =~ /^UFTI/ ) {
          $right = $Frm->hdr( "TRAOFF" );
          $bottom = $Frm->hdr( "TDECOFF" );
       } else {
          $right = $Frm->hdr( "RAOFF" );
          $bottom = $Frm->hdr( "DECOFF" );
       }

# Determine which mask to use from the telescope offsets.  The masks 
# are stored in ARD files.
       if ( $right >= 0 && $bottom >= 0 ) {
          $maskfile = "ard_quad_br.dat";
          $quad = "Bottom-right";

       } elsif ( $right >= 0 && $bottom < 0 ) {
          $maskfile = "ard_quad_tr.dat";
          $quad = "Top-right";

       } elsif ( $right < 0 && $bottom < 0 ) {
          $maskfile = "ard_quad_tl.dat";
          $quad = "Top-left";

       } elsif ( $right < 0 && $bottom >= 0 ) {
          $maskfile = "ard_quad_bl.dat";
          $quad = "Bottom-left";
       }

# Generate the input and output filenames.
       ( my $in, my $out ) = $Frm->inout( "_qm" );

# Specify the parameters.
       my $header = "in=$in out=$out title=\'$quad quadrant masked\'";
       my $hidden = "ardfile=$maskfile";

# Mask the quadrant.  Sets the masked quadrant to bad values.
       $Mon{"kappa_mon"}->obeyw("ardmask","$header $hidden");

# Report the processing.
       orac_print "Orac says: $in to $out: $quad quadrant masked\n";

# Record the new file name in the frame object.
       $Frm->file( $out );                     # obligatory update step

# Display the image.
       _DISPLAY_FRAME_IMAGE_

    }

# Podule
# ======

=head1 NAME

MASK_QUADRANT -- Masks a quadrant of a frame.

=head1 DESCRIPTION

This primitive masks a quadrant of the current frame.  The
chosen quadrant depends on the sense of the telescope offsets.
It reports a successful operation, the quadrant masked, and the
frames concerned.

=head1 NOTES

=over 4

=item *

This primitive is suitable for both UFTI and IRCAM.
Instrument-specific headers are obtained where appropriate.

=item *

Processing only occurs for object frames.

=item *

The masked image can be displayed.

=item *

The frame title is "X is quadrant masked", where X specifies the quadrant.

=item *

It uses the four ARD files produced by primitive L<_DEFINE_QUADRANT_MASKS>.

=back

=head1 OUTPUT DATA

=over 4

=item *

Quadrant-masked frame inheriting the frame's name but with the _qm suffix.

=back

=head1 TASKS

KAPPA: ARDMASK.

=head1 AUTHORS

MJC: Malcolm J. Currie (JAC)

=head1 COPYRIGHT

Copyright (C) 1998-2000 Particle Physics and Astronomy Research
Council.  All Rights Reserved.

=cut
