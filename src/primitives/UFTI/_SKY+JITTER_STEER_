# _SKY+JITTER_STEER_
#
# Control processing for SKY+JITTERn recipes, in particular when to
# file and subtract the sky, and when to make a mosaic.  For the time
# being hardwire to every fifth.  After third is standard procedure.
#
# Arguments:
#    NUMBER = INTEGER (Given)
#       The number of frames in the jitter.  It excludes the sky
#       frame.  The minimum number is 3. [5]
#
# This should only be performed on OBJECT frames.
    if ( $Frm->hdr(OBSTYPE) eq "OBJECT" ||
         $Frm->hdr(OBSTYPE) eq "SKY" ) {

# Obtain the number of frames in the jitter pattern and sky frequency.
       my $number = max( 3, ( $_JITTER_SELF_FLAT_STEER_{NUMBER} || 5 ) );
#       my $number = max( 3, ( $_SKY+JITTER_STEER_{NUMBER} || 5 ) );
       my $cycle = $number + 1;
       my $seqnum = $Grp->num % $cycle;

# Specify when to file and subtract the sky frame.  The first
# frame is sky, followed by NUMBER jitters. 
       if ( $seqnum == 0 ) {
          $Frm->hdr( "FILE_SKY", 1 );
          $Frm->hdr( "SUBTRACT_SKY", 0 );
       } else {
          $Frm->hdr( "FILE_SKY", 0 );
          $Frm->hdr( "SUBTRACT_SKY", 1 );
       }

# Specify during processing of which frames should the objects masked, and a mosaic created.
       if ( $seqnum == $number ) {
          $Frm->hdr( "MAKE_MOSAIC", 1 );

       } else {
          $Frm->hdr( "MAKE_MOSAIC", 0 );
       }

    }
