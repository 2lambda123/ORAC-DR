# _SKY+JITTER_STEER_
#
# Control processing for SKY+JITTERn recipes, in particular when to
# file and subtract the sky, and when to make a mosaic.  For the time
# being hardwire to third and fifth.  After third is standard procedure.
#
# Arguments:
#    NUMBER = INTEGER (Given)
#       The number of frames in the jitter.  It excludes the sky
#       frame.  The minimum number is 3. [5]
#
# This should only be performed on OBJECT frames.
    if ( $Frm->hdr(OBSTYPE) =~ /OBJECT/ ||
         $Frm->hdr(OBSTYPE) =~ /SKY/) {

# Obtain the number of frames in the jitter pattern and sky frequency.
       my $number = max( 3, ( $_JITTER_SELF_FLAT_STEER_{NUMBER} || 5 ) );
       my $cycle = $number + 1;
       my $seqnum = $Grp->num % $cycle;

# Specify when to file and subtract the sky frame.  The first
# frame is sky, followed by NUMBER jitters. 
       if ( $seqnum == 0 ) {
          $Frm->hdr( "FILE_SKY", "TRUE" );
          $Frm->hdr( "SUBTRACT_SKY", "FALSE" );
       } else {
          $Frm->hdr( "FILE_SKY", "FALSE" );
          $Frm->hdr( "SUBTRACT_SKY", "TRUE" );
       }

# Specify during processing of which frames should the objects masked, and a mosaic created.
       if ( $seqnum == 3 || $seqnum == $number ) {
          $Frm->hdr( "MAKE_MOSAIC", "TRUE" );

       } else {
          $Frm->hdr( "MAKE_MOSAIC", "FALSE" );
       }

    }
