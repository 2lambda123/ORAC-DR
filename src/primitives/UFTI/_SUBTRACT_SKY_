# _SUBTRACT_SKY_          -*-perl-*-
#
# Subtracts a bias frame
#
# TASK: CCDPACK - CALCOR
#
# This should only be performed on OBJECT frames.
    if ($Frm->hdr(OBSTYPE) =~ /OBJECT/ || $Frm->hdr(OBSTYPE) =~ /SKY/) {

# Generate the input and output filenames.  The output file has the same
# name as the input except the suffix is changed to indicate it has been
# sky subtracted.
       ($in,$out) = $Frm->inout("_ss");
       $sky = $Cal->sky;
       $header = "in=$in cal=$sky out=$out title=\'Sky subtracted\'";

# Note all sky frames and data frames should have the same exposure time.
# This is taken care of by the Cal object.  The absolute exposure times do 
# not matter, only the relative times, which here is one.
       $Mon{"ccdpack_red"}->obeyw("calcor","$header expose=1 reset accept");

# Report the processing status.
       orac_print "Orac says: $in to $out: sky subtracted\n";

# Now update the output filename in the Frame object.
       $Frm->file($out);

# Display the image.
       _DISPLAY_FRAME_IMAGE_

    };
