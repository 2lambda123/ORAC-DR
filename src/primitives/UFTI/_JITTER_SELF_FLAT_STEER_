# _JITTER_SELF_FLAT_STEER_
#
# Control processing for JITTER_SELF_FLAT, in particular when to
# make a flat and mosaic.  For the time being hardwire to ninth.
# After third is standard procedure.
#
# Arguments:
#    NUMBER = INTEGER (Given)
#       The number of frames in the jitter.  The minimum is 3. [9]
#
# This should only be performed on OBJECT frames.
    if ( $Frm->hdr( "OBSTYPE" ) eq "OBJECT" || 
         $Frm->hdr( "OBSTYPE" ) eq "SKY" ) {

# Obtain the number of frames in the jitter pattern.
       my $number = max( 3, ( $_JITTER_SELF_FLAT_STEER_{NUMBER} || 9 ) );

# Specify during processing of which frames should the flat be created,
# flat-field creation with objects masked, a mosaic created, and
# aperture photometry performed.
       if ( ($Grp->num + 1) % $number == 0 ) {
          $Frm->hdr( "MAKE_FLAT", 1 );
          $Frm->hdr( "MAKE_MOSAIC", 1 );
          $Frm->hdr( "MASK_OBJECTS", 1 );
          $Frm->hdr( "DO_APHOT", 1 );
       
       } else {
          $Frm->hdr( "MAKE_FLAT", 0 );
          $Frm->hdr( "MAKE_MOSAIC", 0 );
          $Frm->hdr( "MASK_OBJECTS", 0 );
          $Frm->hdr( "DO_APHOT", 0 );
       }

# Insert the cycle number of the set of NUMBER frames.
       $Frm->hdr( "CYCLE_NUMBER", int( $Grp->num / $number ) );

# Insert the number of frames in the jitter.
       $Frm->hdr( "JITTER_NUMBER", $number );

# All frames are target.  Some more-general primitives need to select 
# targets from sky frames.
       $Frm->hdr( "TARGET_OR_SKY", "target" );
    }
