# -*-perl-*-


# Show histogram is display is active


if (defined $Display) {
  $Display->display_data($Frm,{REGION=>0, 
			       TYPE=>'HISTOGRAM',
			       NBINS=>256,
			       XAUTOSCALE=>1,
			       YAUTOSCALE=>1,
			       ZAUTOSCALE=>1,
			       TOOL=>'KAPVIEW',
			       WINDOW=>0
			      });
};

my $min = orac_read("Mark as bad all data below which value?>");


my $max = orac_read("Mark as bad all data above which value?>");

orac_print("Thresholding data outside the values $min and $max\n");

my $in = $Frm->file;
my $out = "bpm_".$Frm->number;

# set all values outside the provided limitis to bad
$Mon{'kappa_mon'}->obeyw("thresh","in=$in out=tmp$$ thrlo=$min thrhi=$max newhi=bad newlo=bad title=$out");
# set all (good) values to 0
# note that UFTI does not use the same convention
# the value of 0 for good pixels was chosen by THK for similarity with CGS4
# this might be changed if it does not work out....
$Mon{'kappa_mon'}->obeyw("thresh","in=tmp$$ out=$out thrlo=$max thrhi=$max newhi=bad newlo=0 title=$out");
# delete temporary file
$Mon{'ndfpack_mon'}->obeyw("erase","object=tmp$$ ok");

orac_print("The bad pixel mask $out has been created.\n");



