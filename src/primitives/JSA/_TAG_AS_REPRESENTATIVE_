# -*-cperl-*-

=head1 NAME

_TAG_AS_REPRESENTATIVE_ - Tag a file as representative.

=head1 DESCRIPTION

This primitive tags a file, Frame, or Group as representative.

=head1 ARGUMENTS

=over 4

=item DISPLAY = LOGICAL (Given)

Whether to display the current Group or Frame (see GROUP) file.  [1]

=item FILE = STRING (Given)

By default the file to tag comes from either the current Frame or
current Group object (see GROUP argument). If the FILE argument is
supplied, then this file overrides the GROUP argument. ['']

=item GROUP = LOGICAL (Given)

Whether to operate on the current Group or Frame. Defaults to
Frame. [0]

=item SUFFIX = STRING (Given)

The suffix to add. ['rimg'].

=item UPDATE = LOGICAL (Given)

Whether or not to update the current Frame or Group object with the
tagged file. [0]

=back

=head1 OUTPUT DATA

=over 4

=item *

The file with the requested suffix.

=item *

If UPDATE is true, the input Frame or Group object has product defined
as the requested suffix, and the output file(s) is(are) tagged with
that suffix.

=back

=head1 SEE ALSO

_CREATE_GRAPHIC_FROM_FILE_

=head1 AUTHORS

Brad Cavanagh E<lt>b.cavanagh@jach.hawaii.eduE<gt>
Andy Gibb E<lt>agg@astro.ubc.caE<gt>,
Malcolm J. Currie E<lt>mjc@jach.hawaii.eduE<gt>

=head1 COPYRIGHT

Copyright (C) 2008, 2013 Science and Technology Facilities Council.
Copyright (C) 2013 the University of British Columbia.
All Rights Reserved.

=cut

my $display = get_prim_arg( $_PRIM_ARGS_, "DISPLAY", 1 );
my $file = $_PRIM_ARGS_->{FILE};
my $group = ( $_PRIM_ARGS_->{GROUP} ? 1 : 0 );
my $suffix = get_prim_arg( $_PRIM_ARGS_, "SUFFIX", "rimg" );
my $update = ( $_PRIM_ARGS_->{UPDATE} ? 1 : 0 );

my $Obj = ( $group ? $Grp : $Frm );

my $in = $file;
my $out;
if( ! defined( $file ) ) {
  ( $in, $out ) = $Obj->inout( "_$suffix" );
} else {
  ( undef, $out ) = $Obj->inout( "_$suffix" );
}

$Mon{'ndfpack_mon'}->obeyw( "ndfcopy", "in=$in out=$out" );

orac_print "$in to $out:\n Tagged as representative.\n\n";

_SET_FILE_FITS_ITEM_ FILE=$out KEY=PRODUCT VALUE=$suffix

if ( $display ) {
  _DISPLAY_FILE_ FILE=$out GROUP=$group
}

_CREATE_GRAPHIC_FROM_FILE_ FILE=$out ADDRES=1 TYPE=PNG

_CREATE_GRAPHIC_FROM_FILE_ FILE=$out ADDRES=1 XRES=256 YRES=256 TYPE=PNG

_CREATE_GRAPHIC_FROM_FILE_ FILE=$out ADDRES=1 XRES=1024 YRES=1024 TYPE=PNG

if( $update ) {
  $Obj->force_product_update( $suffix, $out );
  $Obj->tagset( $suffix );
}
