my $outfile = (defined $_CHANNELSTATS_{OUT} ? $_CHANNELSTATS_{OUT} : "");
if (! $outfile) {
    $outfile = sprintf("chanstats_%s_%05d%s",$Frm->hdr("ORACUT"),$Grp->name,
        $Frm->fitssuffix);
}

# Get the channel table

$ENV{'ORAC_INSTRUMENT'} =~ /^WFCAM(\d)$/;
my $tabnum = $1;
my $chantable = sprintf("%s/wfcam_chan%d.fit[1]",$ENV{'ORAC_DATA_CAL'},$tabnum);

# Put the name of the input file into an array...

my @allinf = ($Frm->file);

# Now do the stats...

my $errmsg;
my $retval = cir_chanstats(\@allinf,1,$chantable,$outfile,$errmsg);
if ($retval != CIR_OK) {
    orac_throw "CIR_CHANSTATS: filed in _CHANNELSTATS_\n$errmsg\n";
}

=head1 NAME

_CHANNELSTATS_ -- Do stats on each channel in a frame. 

=head1 DESCRIPTION

The input frame is broken into its constituent data channels according to
the information provided on the channel table. Stats are done on each channel.
The results are written into a FITS table. The stats in the FITS table can
be updated with another input file.

=head1 ARGUMENTS

=over 4

=item OUT = char (Given)

The name of the FITS container file with the output FITS table.

=back

=head1 NOTES

The channel table should be the ORAC_DATA_CAL directory as wfcam_chanX.fit
where X is the camera number of WFCAM that is being used. 

If an output table name is not provided, then one called 
"chanstats_XXXXXXXX_YYYYY.fit" will be created, where XXXXXXXX is the UT date
and YYYYY is the group name. The output table will contain the following 
columns:

=over 4

=item chanindex

The channel index as specified in the channel table.

=item N_input

The number of contributions to the current row's statistics.

=item mean

The running mean of all the contributions.

=item variance

The running variance of all the contributions.

=item run_total

The running total of all the contributions.

=item run_total2

The running sum of squares of all contributions

=back

=head1 AUTHORS

JRL: Jim Lewis (CASU, IoA)

=head1 COPYRIGHT

Copyright (C) 2004-2007 Cambridge Astronomy Survey Unit.
All Rights Reserved

=cut
