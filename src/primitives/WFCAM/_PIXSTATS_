my $outfile = (defined $_PIXSTATS_{OUT} ? $_PIXSTATS_{OUT} : "");
if (! $outfile) {
    $outfile = sprintf("pixstats_%s_%05d%s",$Frm->hdr("ORACUT"),$Grp->name,
	$Frm->fitssuffix);
}

# Now do the work

my $filename = $Frm->file;
orac_print("Adding $filename into stats file $outfile\n");
for my $i (1 .. $Frm->findnsubs) {
    my $subfile = $Frm->getasubframe($i)->file;
    my $snum = $Frm->getasubframe($i)->subfrmnumber;
    my $outf = sprintf("%s[%d]",$outfile,$snum);
    my $all = [$subfile];
    my ($retval,$errmsg);
    $retval = cir_pixstats($all,1,$outf,$errmsg);
    if ($retval != CIR_OK) {
        orac_throw("CIR_PIXSTATS: Failed in _PIXSTATS_\n$errmsg\n");
    }    
}


=head1 NAME

_PIXSTATS_ -- Do running stats on each pixel in a frame.

=head1 DESCRIPTION

The image in the current frame is added to the the running stats on a series
of frames. The running stats frame (OUT) will have a data cube where each
plane of the cube represents a different statistic. See below for a full
description.

=head1 ARGUMENTS

=over 4

=item OUT = char (Given)

The name of the output FITS container file for the running stats. If a name
is not given, then the file will be called "pixstats_XXXXXXXX_YYYYY.fit", where
XXXXXXXX is the UT date and YYYYY is the current group name.

=back

=head1 NOTES

The output file currently is an image extension with a data cube. The
stats in each plane of the cube are:

=over 4

=item 1.

The total number of input pixels at this position

=item 2. 

The mean value at this position

=item 3. 

The variance at this position

=item 4. 

The population variance = (n/(n-1))*variance (0 for n = 1)

=item 5. 

The running total at this position

=item 6. 

The running total of squares at this position

=head1 AUTHORS

JRL: Jim Lewis (CASU, IoA)

=head1 COPYRIGHT

Copyright (C) 2004-2007 Cambridge Astronomy Survey Unit.
All Rights Reserved

=cut

