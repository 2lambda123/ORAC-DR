    # Get the best offset sky available for the current frame

    my $skyfile = $Cal->sky;
    my $skyfrm = $Frm->new($skyfile);

    # Get the current frame and cycle through all of the extensions

    my $fname = $Frm->file;
    my $nextn = $Frm->findnsubs;
    foreach my $i (1 .. $nextn) {
	my $subfrm = $Frm->getasubframe($i)->file;
        my $subskyfrm = $skyfrm->getasubframe($i)->file;
	my ($retval,$errmsg);
        $retval = cir_imsubt($subfrm,$subskyfrm,$errmsg);
        if ($retval != CIR_OK) {
            orac_err("CIR_IMSUBT: Failed in _OFFSET_SKY_SUBTRACT_\n$errmsg\n");
            next;
        }
	
	# Update the header to show that the sky subtraction is
	# now done.

	my $line = sprintf("Done _OFFSET_SKY_SUBTRACT_: %s",
	    $subskyfrm);
	$retval = cir_update_hdr($subfrm,"SKYSUB","STRING",$line,
	    "",$errmsg);
    }

 
=head1 NAME
 
_OFFSET_SKY_SUBTRACT_ -- Subtract a sky estimate from the calibration system.
This has probably come from another observation.

=head1 DESCRIPTION

A sky estimate is taken from the sky calibration index and subtracted from
the current frame.
 
=head1 ARGUMENTS

None

=head1 NOTES
 
None
 
=head1 AUTHORS
 
JRL: Jim Lewis (CASU, IoA)
 
=head1 COPYRIGHT
 
Copyright (C) 2004-2007 Cambridge Astronomy Survey Unit.
All Rights Reserved
 
=cut
