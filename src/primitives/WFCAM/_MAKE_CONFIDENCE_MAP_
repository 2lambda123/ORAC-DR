    # Get parameters

    my $outf = (defined $_MAKE_CONFIDENCE_MAP_{OUT} ? $_MAKE_CONFIDENCE_MAP_{OUT} : "");
    my $thresh = (defined $_MAKE_CONFIDENCE_MAP_{THRESH} ? $_MAKE_CONFIDENCE_MAP_{THRESH} : 5.0);
    my $niter = (defined $_MAKE_CONFIDENCE_MAP_{NITER} ? $_MAKE_CONFIDENCE_MAP_{NITER} : 2);
    my $window = (defined $_MAKE_CONFIDENCE_MAP_{WINDOW} ? $_MAKE_CONFIDENCE_MAP_{WINDOW} : 0);

    # If there is no output map defined, then we should get out of here

    if (! $outf) {
        orac_throw "_MAKE_CONFIDENCE_MAP_: No output map specified\n";
    }

    # How many extensions do we have here?

    my $nextn = $Frm->findnsubs;

    # Make the map for each extension

    foreach my $i (1 .. $nextn) {
        my $infile = $Frm->getasubframe($i)->file;
        my $outfile = sprintf("%s[%d]",$outf,$i);
        my $errmsg;
        my $retval = cir_mkconf($infile,$outfile,$thresh,$niter,$window,$errmsg);
        if ($retval != CIR_OK) {
            orac_throw "CIR_MKCONF: failed in _MAKE_CONFIDENCE_MAP_\n$errmsg\n";
        }
    }

    # Create a file object for the output file and then update the
    # header to tell it that it's a confidence map.

    my $tmpFrm = $Frm->new($outf);
    $tmpFrm->update_header("WFRTYPE",TSTRING,CALCPM,"Calibration frame type");
    $tmpFrm->update_header("MASKTYPE",TINT,MASK_CPM,"This is a confidence map");
    _FILE_CPM_ NAME=$outf
