my $outfile = (defined $_TWO_FRAME_DIFF_{OUT} ? $_TWO_FRAME_DIFF_{OUT} : "");

if ($Frm->uhdr("LIST_COMPLETE")) {
    my $allfr = $Frm->uhdr("FILE_LIST");
    my $grp = $Grp->new;
    my @allmem = ();
    foreach my $fname (@$allfr) {
        my $frm = $Frm->new($fname);
        push @allmem,$frm;
    }
    if (! $outfile) {
        $outfile = "twofrms_" . $allmem[0]->file;
    }
    $grp->allmembers(@allmem);
    {
        my $Grp = $grp;
        _SUBTRACT_TWO_FILES_ OUT=$outfile
    }
    $_TWO_FRAME_DIFF_{OUT} = $outfile;
}

 
=head1 NAME
 
_TWO_FRAME_DIFF_ -- Create a file which is the difference of two frames.

=head1 DESCRIPTION

When signalled that the file list is complete, then the routine grabs the
list of frame objects from the current frames uhdr structure. All of the
files are associated with a new frame object and are pushed into a new group.
This is passed into the subtraction primitive.
 
=head1 ARGUMENTS
 
=over 4
 
=item OUT = char (Given/Returned)
 
The name of the FITS container file with the resulting difference. If this
isn't specified on input, then it will be "twofrms_XXXXXXX.fit" where
XXXXXXX is the name of the first of the input frames.
 
=back
 
=head1 NOTES
 
This routine isn't run unless the value of $Frm->uhdr("LIST_COMPLETE") is
set. Then the list of file names must be an array reference in
$Frm->uhdr("FILE_LIST").

=head1 AUTHORS
 
JRL: Jim Lewis (CASU, IoA)
 
=head1 COPYRIGHT
 
Copyright (C) 2004-2007 Cambridge Astronomy Survey Unit.
All Rights Reserved
 
=cut
