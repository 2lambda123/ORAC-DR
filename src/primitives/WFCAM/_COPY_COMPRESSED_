# Is the compressed data directory environment variable defined?

if ($ENV{'ORAC_DATA_CASU'}) {

   # Check to see if the directory exists.  If it doesn't then create it.
   if (! -d $ENV{'ORAC_DATA_CASU'}) {
      if (! mkdir $ENV{'ORAC_DATA_CASU'}) {
         orac_err("Unable to create directory for compressed data $ENV{'ORAC_DATA_CASU'}\n");
      }
   }

   # Right, now assuming all that went well, we can now copy the file 
   # over into the casu directory. If it already exists, then don't bother
   # to try and do it again.

   my $infile = $Frm->file;
   my $outfile = sprintf("%s/%s",$ENV{'ORAC_DATA_CASU'},$infile);
   if (-f $outfile) {
      orac_print("CASU file $outfile already exists\n");
   } else {
      my $errmsg;
      my $retval = cir_compress_fits($infile,$outfile,$errmsg);
      if ($retval != CIR_OK) {
         orac_err("CIR_COMPRESS_FITS: failed in _COPY_COMPRESSED_\n$errmsg\n");
      }
      orac_print("CASU file $outfile created\n");
   }
} else {
   orac_warn("Compressed data environment variable unset - will not create files for export\n");
}


=head1 NAME

_COPY_COMPRESSED_ -- Make a copy of an input FITS file to a Rice tile
compressed FITS file

=head1 DESCRIPTION

A copy of the current input fits frame is made. This is done with the CFITSIO
Rice tile compression algorithm. The result is written a directory pointed
to by ORAC_DATA_CASU

=head1 ARGUMENTS

None 

=head1 NOTES

The environment variable ORAC_DATA_CASU must be defined and must point to
a directory that can be created and written to.

=head1 AUTHORS

JRL: Jim Lewis (CASU, IoA)

=head1 COPYRIGHT

Copyright (C) 2004-2007 Cambridge Astronomy Survey Unit.
All Rights Reserved

=cut
