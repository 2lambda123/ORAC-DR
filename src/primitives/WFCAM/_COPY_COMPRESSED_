# Is the compressed data directory environment variable defined?

if ($ENV{'ORAC_DATA_CASU'}) {

   # Check to see if the directory exists.  If it doesn't then create it.
   if (! -d $ENV{'ORAC_DATA_CASU'}) {
      if (! mkdir $ENV{'ORAC_DATA_CASU'}) {
         orac_err("Unable to create directory for compressed data $ENV{'ORAC_DATA_CASU'}\n");
      }
   }

   # Right, now assuming all that went well, we can now copy the file 
   # over into the casu directory. If it already exists, then don't bother
   # to try and do it again.

   my $infile = $Frm->file;
   my $outfile = sprintf("%s/%s",$ENV{'ORAC_DATA_CASU'},$infile);
   if (-f $outfile) {
      orac_print("CASU file $outfile already exists\n");
   } else {
      my $errmsg;
      my $retval = cir_compress_fits($infile,$outfile,$errmsg);
      if ($retval != CIR_OK) {
         orac_err("CIR_COMPRESS_FITS: failed in _COPY_COMPRESSED_\n$errmsg\n");
      }
      orac_print("CASU file $outfile created\n");
   }
} else {
   orac_warn("Compressed data environment variable unset - will not create files for export\n");
}
