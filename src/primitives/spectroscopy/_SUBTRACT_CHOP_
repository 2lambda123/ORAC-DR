=head1 NAME

_SUBTRACT_CHOP_ - subtract the bias frame from the current frame

=head1 DESCRIPTION

This primitive subtracts the two chop beams in the current frame.
Nothing happens if the observation isn't of type CHOP


=head1 AUTHOR

Paul Hirst <p.hirst@jach.hawaii.edu>

=cut

# Chop subtraction is only applicable to CHOP mode

if ( $Frm->uhdr( "ORAC_DETECTOR_MODE" ) eq "CHOP" ) {

  # Process all the sub-files.
  # I guess the sequence in the HDS is thus:
  # .I1 .I1BEAMA .I1BEAMB .I2 .I2BEAMA .I2BEAMB .I3 .I3BEAMA .I3BEAMB etc etc
  # OK, but oracdr's inout method only gives you the .In frames
  # Worry about variance later

  foreach my $i (1 .. $Frm->nfiles) {
    # Generate the input and output filenames. CBS = Chop Beam Subtracted
    my ( $in, $out ) = $Frm->inout( "_cbs", $i );
    
    # Just copy the pre-subtracted one for now
    $Mon{'ndfpack_mon'}->obeyw("ndfcopy", "in=$in out=$out title=$out");

    # Report the processing status.
    orac_print "$in to $out: chop pre-subtracted frame copied\n";
      
    # Record the new file name in the frame object.
    $Frm->file( $i, $out );
  }
    
} else {
  orac_print "Not a CHOP observation; therefore no chop beam subtraction.\n";
}

orac_print "\n";
