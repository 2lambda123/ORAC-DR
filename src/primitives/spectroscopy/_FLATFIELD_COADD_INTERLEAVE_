# -*-perl-*-


# Obtain the keyword associated with the ORAC_NSCAN_POSITIONS
# header, corresponding to the number of detetector increments.
# It is this key which is used by the flat index.

# Obtain the name of the current flat, and a reference to its entry in
# the flat index.
    my $flat = $Cal->flat;
    my $flathdrref = $Cal->flatindex->indexentry( $flat );

# Find the number of scan positions in the flat using the derived
# keyword.
    my $sampling = $$flathdrref{"SAMPLING"};
    orac_print "Flat frame $flat will be used.\n";

    if ( $sampling eq "1x1" ) {
       orac_print "Flat frame $flat is undersampled.\n";
       _DIVIDE_BY_FLAT_SPECT_
       _INTERLEAVE_COADD_
    } else {
       orac_print "Flat frame $flat is oversampled.\n";
       _INTERLEAVE_COADD_
       _DIVIDE_BY_FLAT_SPECT_
    }

# Display the the current frame.
    $Display->display_data( $Frm ) if ( defined $Display );

