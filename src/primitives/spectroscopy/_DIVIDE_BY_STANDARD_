=head1 NAME

_DIVIDE_BY_STANDARD_ 

=head1 DESCRIPTION

Asks the calibration system for a suitble standard star, and divides by it.

=head1 NOTES

The input frames should have been normalised to 1 second exposures.

=head1 AUTHOR

Paul Hirst <p.hirst@jach.hawaii.edu>

=head1 COPYRIGHT

Copyright (C) 1998-2001 Particle Physics and Astronomy Research
Council. All Rights Reserved.

=cut

if ($Frm->uhdr("PAIR_COMPLETE")) {

  my $base = $Grp->raw;
  my $in = $Grp->file;
  my $out;

  # Copy the group uhdr into the frame uhdr for the Cal system to see it
  my $ndims = $Grp->uhdr("NDIMS");
  $Frm->uhdr("NDIMS", $ndims);

  # Need a different name for images and spectra for display system.  
  if($ndims == 2) {
     $out = $base."_dbsi";
  } else {
     $out = $base."_dbs";
  }

  # Find me a standard
  my $std = $Cal->standard;
  orac_print "Standard: $std will be used\n";

  # Shift the spectrum to the same wavelength as the standard
  _ALIGN_SPECTRUM_TO_STD_ STANDARD=$std
  $in = $Grp->file;

  # Divide by it
  $Mon{'kappa_mon'}->obeyw("div", "in1=$in in2=$std out=$out title=$out");
  orac_print "$in to $out: Divided by standard: $std\n";

  # Update the Group object
  $Grp->file( $out );

  # Display the dbs frame
  $Display->display_data( $Grp ) if defined $Display;

  orac_print "\n";
}
