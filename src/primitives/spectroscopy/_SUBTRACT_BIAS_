=head1 NAME

_SUBTRACT_BIAS_ - subtract the bias frame from the current frame

=head1 DESCRIPTION

This primitive subtracts the bias from the current frame.
Nothing happens if the observation is of type ND_STARE.

=head1 OUTPUT FILES

The following files are created:

=over 4

=item C<_db>

Debiased file.

=back

=head1 EXTERNAL TASKS

The following external tasks are used:

=over 4

=item KAPPA

C<sub>

=head1 AUTHOR

Frossie Economou
Paul Hirst <p.hirst@jach.hawaii.edu>

=cut

# Skip if actually a BIAS frame.
unless ( $Frm->uhdr( "ORAC_OBSERVATION_TYPE" ) eq "BIAS" ) {

  # Bias subtraction is not applicable for ND_STARE mode.
  # What's this about MICHELLE ? (PH)

  if ( $Frm->uhdr( "ORAC_DETECTOR_MODE" ) ne "ND_STARE" && 
       uc( $Frm->uhdr( "ORAC_INSTRUMENT" ) ) ne "MICHELLE" ) {

    # Obtain the bias frame.
    my $bias = $Cal->bias;

    # Process all the sub-files.
    foreach my $i ( 1..$Frm->nfiles ) {
      
      # Generate the input and output filenames.
      my ( $in, $out ) = $Frm->inout( "_db", $i );
      
      # Subtract the bias.
      $Mon{"kappa_mon"}->obeyw( "sub", "in1=$in out=$out in2=$bias title=$out" );
      
      # Report the processing status.
      orac_print "$in to $out: bias: $bias subtracted\n";
      
      # Record the new file name in the frame object.
      $Frm->file( $i, $out );
    }
    
  } else {
    orac_print "ND_STARE observation; therefore no bias subtracted.\n";
  }
}

orac_print "\n";
