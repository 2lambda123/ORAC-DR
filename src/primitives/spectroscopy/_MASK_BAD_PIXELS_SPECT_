#+
# Name:
#    _MASK_BAD_PIXELS_
#
# Purpose:
#    Applies a bad-pixel mask.
#
# Language:
#    Perl5
#
# Description:
#    This primitive applies the bad-pixel mask to the current frame's, 
#    sub-images, creating a masked frame for each sub-image by adding a
#    pixel mask.  The bad pixels are specified by Starlink bad (`magic')
#    values.  The primitive reports each successful masking and the frames
#    concerned.
#
# Notes:
#    -  This primitive is suitable for CGS4, and Michelle in
#    spectroscopy mode.
#    -  The mask frame is obtained from the $Cal->mask method.
#    -  The sub-image title is the name of the output NDF.
#
# Output Data:
#    -  Bad-pixel-masked subframes inheriting the current frame's name 
#    but with the _bp suffix.
#
# Tasks:
#    KAPPA: ADD.
#
# Authors:
#    MJC: Malcolm J. Currie (JAC)
#    FE: Frossie Economou (JAC)
#
# Copyright:
#    Copyright (C) 1998-2001 Particle Physics and Astronomy Research
#    Council.  All Rights Reserved.
#
#-

# Set the user-accessible mapping and parameters.
# Use Cal->mask?
    my $mask = $Cal->mask;
    orac_print "\nBad-pixel mask $mask will be used\n";

# Process each data array.
    foreach my $i ( 1..$Frm->nfiles ) {

# Generate the input and output filenames.
       ( my $in, my $out ) = $Frm->inout( "_bp", $i );

# Add the mask which comprises bad pixels and zero elsewhere.
       $Mon{"kappa_mon"}->obeyw( "add", "in1=$in out=$out in2=$mask title=$out" );

# Report the processing status.
       orac_print "$in to $out: Bad pixels done\n";

# Record the new file name in the frame object.
       $Frm->file( $i, $out );
    }

    orac_print "\n";

# Podule
# ======

=head1 NAME

_MASK_BAD_PIXELS_ -- Applies a bad-pixel mask.

=head1 DESCRIPTION

This primitive applies the bad-pixel mask to the current frame's, 
sub-images, creating a masked frame for each sub-image by adding a pixel mask.
The bad pixels are specified by Starlink bad (`magic') values.  The 
primitive reports each successful masking and the frames concerned.

=head1 NOTES

=over 4

=item *

This primitive is suitable for CGS4, and Michelle in spectroscopy mode.

=item *

The mask frame is obtained from the $Cal-E<gt>mask method.

=item *

Each sub-image title is the name of the output NDF.

=back

=head1 OUTPUT DATA

=over 4

=item *

Bad-pixel-masked sub-images inheriting the current frame's name but with
the _bp suffix.

=back

=head1 TASKS

KAPPA: ADD.

=head1 AUTHORS

MJC: Malcolm J. Currie (JAC)
FE: Frossie Economou (JAC)

=head1 COPYRIGHT

Copyright (C) 1998-2001 Particle Physics and Astronomy Research
Council.  All Rights Reserved.

=cut

