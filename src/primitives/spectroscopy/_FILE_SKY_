
=head1 NAME

_FILE_SKY_  - Files a SKY observations

=head1 DESCRIPTION

Exactly what it says on the can

=head1 AUTHORS

Paul Hirst <p.hirst@jach.hawaii.edu>
Malcolm J. Currie (JAC)
Brad Cavanagh (JAC)

=cut

if ($Frm->nfiles == 1) {
  
   unless ( $Frm->uhdr( "ORAC_OBSERVATION_TYPE" ) eq "SKY" ) {
      orac_warn "This is not a sky frame!  Running the wrong recipe?\n";
      orac_warn "The recipe continues, assuming you know what you're doing.\n";
   }

   # Obtain the current frame's number.
   my $obsnum = $Frm->uhdr( "ORAC_OBSERVATION_NUMBER" );
  
   # Take a copy of the current frame using a more-identifiable name.
   my $in = $Frm->file;
   my $sky = "sky_" . $obsnum;
   $Mon{'ndfpack_mon'}->obeyw("ndfcopy", "in=$in out=$sky");
  
   # Store the sky as the current frame.
   $Frm->file($sky);
  
   # File the current frame as the current sky.
   $Cal->sky($Frm->file);
  
   # Report the processing status.
   orac_print $Frm->file . " filed as the current sky.\n";
  
   # Add this frame to the index of sky frames.
   $Cal->skyindex->add( $Frm->file, {%{$Frm->hdr}, %{$Frm->uhdr}} );
  
   # Report the processing status.
   orac_print $Frm->file . " added to index file.\n";
  
   } else {
      orac_warn "Sky frame has not been copied.  Not filed as calibration.\n";

}

