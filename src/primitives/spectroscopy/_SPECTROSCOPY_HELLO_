=head1 NAME

_SPECTROSCOPY_HELLO_ - The first step in processing spectroscopy data.

=head1 DESCRIPTION

The first step in processing spectroscopy data.

* Calls _MAKE_RAW_FILE_ to copy the frame to a _raw file 
  in $ORAC_DATA_OUT

* Switches on History recording

* Adds the SAMPLING user header

* Adds the frame to the on-the-fly nightlog.

=head1 AUTHORS

Paul Hirst <p.hirst@jach.hawaii.edu>
Frossie Economu

=cut

# Keep the output tidy
orac_print "\n";

# Make the _raw file
_MAKE_RAW_FILE_

# Switch history recording on.
# Because we hace copied to _raw, we don't have to worry
# any more about modifying the sacred files in ORAC_DATA_IN
foreach my $frame ( $Frm->files ) {
   $Mon{"ndfpack_mon"}->obeyw( "hisset", "ndf=$frame" );
   orac_print "$frame: History recording enabled\n";
}

orac_print "\n";

# Add the SAMPLING uhdr
my $detincr = $Frm->uhdr("ORAC_SCAN_INCREMENT");
my $detnincr = $Frm->uhdr("ORAC_NSCAN_POSITIONS");
my $n = nint (1 / $detincr);
my $m = nint ($detincr * $detnincr);;
my $sampling = $n."x".$m;
# With 1x1, detincr is void
if ($detnincr==1) {
  $sampling = "1x1";
  }
$Frm->uhdr('SAMPLING', $sampling);
orac_print("Observation Sampling is: $sampling\n");
my $nfiles = $Frm->nfiles;
orac_print "There are $nfiles integrations in this observation\n";
orac_print "\n";

# Make sure that the Grp contains a uhdr value for NDIMS.  NDIMS is
# used by the divide-by-standard primitive to determine whether to
# divide by an image or a spectrum.  It is always 2-dimensional at the
# start.
$Grp->uhdr( "NDIMS", 2 );

# Build the nightlog on the fly.
_NIGHT_LOG_SPECT_ OUT=1

# Keep the output tidy
orac_print "\n";
