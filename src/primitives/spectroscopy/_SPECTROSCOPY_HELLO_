=head1 NAME

_SPECTROSCOPY_HELLO_

=head1 DESCRIPTION

The first step in processing spectroscopy data.

If the frame is 1x1 sampled, copies it into a single NDF (_raw), and
offers it to the display system.

Switches on History recording

Misc. header operations.

Adds the frame to the on-the-fly nightlog.

=head1 AUTHORS

Paul Hirst <p.hirst@jach.hawaii.edu>
Frossie Economu

=cut

# Make a simple NDF if possible.
# ==============================
# Convert a one-integration HDS container file to a simple NDF with
# the _raw suffix.
if ( $Frm->nfiles == 1 ) {
  my ( $in, $out ) = $Frm->inout( "_raw" );
  $Mon{"ndfpack_mon"}->obeyw( "ndfcopy", "in=$in out=$out" );
  
  # Note this uses the files plural method.  This forces the creation
  # of the NDF when we supply a single NDF.
  $Frm->files( $out );
  $Frm->mergehdr;  

  orac_print "$in to $out: Single NDF created for 1x1 sampled data\n";
  $Display->display_data( $Frm ) if ( defined $Display );
}

# Switch history recording on.
foreach my $frame ( $Frm->files ) {
  $Mon{"ndfpack_mon"}->obeyw( "hisset", "ndf=$frame" );
  orac_print "$frame: History recording enabled\n";
}

# Record the original spectroscopic dimention. Take this out of
# _INTERLEAVE_... later (PH).

my $xdim = $Frm->uhdr("ORAC_X_DIM");
$Frm->uhdr("ORIGINAL_SPECTROSCOPIC_DIMENTION", $xdim);

# Make sure that the Grp contains a uhdr value for NDIMS.  NDIMS is
# used by the divide-by-standard primitive to determine whether to
# divide by an image or a spectrum.  It is always 2-dimensional at the
# start.
$Grp->uhdr( "NDIMS", 2 );

# Build the nightlog on the fly.
_NIGHT_LOG_SPECT_ OUT=1

orac_print "\n";
