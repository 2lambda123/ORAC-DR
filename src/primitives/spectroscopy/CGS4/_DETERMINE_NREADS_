=head1 NAME

_DETERMINE_NREADS_ - Determine the number of array reads / exposure

=head1 DESCRIPTION

Adds a Frame user header (NREADS) that contains the number of
array reads per exposure.

In this (CGS4 specific) version, this is determined from the 
exposure time and mode - by knowing (or guessing) what the ALICE
is programmed to do.

=head1 AUTHORS

Paul Hirst <p.hirst@jach.hawaii.edu>

=cut

my $nreads = 0;

# What's the array mode?
if ($Frm->uhdr("ORAC_DETECTOR_MODE") ne "ND_STARE") {
  # We're not in ND_STARE - thus 1 read
  $nreads = 1;
} else {
  # We're in ND_STARE mode - depends on exposure time.
  # This is a bit of an informed guess right now
  my $t = $Frm->uhdr("ORAC_EXPOSURE_TIME");
  if ($t <= 1 ) {
    # Less than 1 sec. Read at start and end only
    $nreads = 2;
  } elsif ($t <= 60) {
    # More than 1 but less than 60. Read every second
    $nreads = 1 + int ($t);
  } else {
    # More than 60 secs. It does 60 reads equally spaced or something
    $nreads = 60;
  }
}

orac_print "Number of array reads per exposure: $nreads\n";

$Frm->uhdr("NREADS", $nreads);

orac_print "\n";
