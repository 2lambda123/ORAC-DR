=head1 NAME

_ADD_READNOSE_VARIANCE_

=head1 DESCRIPTION

Adds an initial variance component, which is simply flat and equal to the
readnoise of the detector, taking the GAIN into account.

This should be done properly with the Cal system to pull the value from the
previous array_tests. For now, it's hard-coded to 40 electrons.

=head1 AUTHOR

Paul Hirst <p.hirst@jach.hawaii.edu>

=cut

# Get the gain
my $gain = $Frm->uhdr("ORAC_GAIN");

# Get the readnoise, in electrons
my $rne = 40;

# Get the readnoise in data-numbers
my $rn = $rne / $gain;


# Loop through the sub-files
foreach my $i (1 .. $Frm->nfiles) {
	# Generate the input and output file names
	my ($in, $out) = $Frm->inout ("_rnv", $i);

	# Add the variance aray
	$Mon{'ndfpack_mon'}->obeyw("ndfcopy", "in=$in out=$out");
	$Mon{'ndfpack_mon'}->obeyw("setvar", "ndf=$out variance=$rn");

	# Update Frame object
	$Frm->file($i, $out);
}
