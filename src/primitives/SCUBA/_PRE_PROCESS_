=head1 NAME

PRE_PROCESS

=head1 SYNOPSIS


=head1 DESCRIPTION

Primitive for pre-processing SCUBA data.
This includes removing the nods, splitting
the raw data into Data, Variance and Quality.

This primitive must be run at the start of all SCUBA data
reduction sequences involving SURF


=head1 TASKS

This primitive calls the REDUCE_SWITCH task from the SURF
monolith.

=cut

# First thing to do is set the current filename
# Do not want to use the raw filename. This means that
# I am assuming this is the first primitive in the pipeline
# to access the demodulated data. Frossie won't like this
# and neither do I. This can not be helped if we are 
# using SURF since REDUCE_SWITCH must be run before
# anything else.

# One test I will do is only to change the file() if
# it is the same as raw(). This will let the file be processed
# before I get to it since I won't change it if that is the case

my $raw = $Frm->raw;
$raw =~ s/\.sdf$//; # Very naughty - should use method for this

my ($in,$out);
if ($raw eq $Frm->file) {

  # Note that the template() Frame method must be changed to 
  # understand the change in naming convention here since that
  # method works by replacing numbers with other numbers (without
  # knowing the original number)

  # Set in to be the raw without the _dem
  $in = $raw;
  $out = $Frm->inout("_resw");
  $out =~ s/_dem//;

#  $out = $Frm->file("o".$Frm->number);
#  $in = $raw; # Cant use raw as such since this has .sdf extension
} else {
  # Standard way of generating input and output names
  ($in, $out) = $Frm->inout("_resw");
}


# Take default parameters for REDUCE_SWITCH

$Mon{surf_mon}->obeyw("reduce_switch", "in=$in out=$out reset accept");

$Frm->file($out);                       # obligatory update step

orac_print "ORAC says: Pre-processing complete\n";


# COPYRIGHT
#
#   Copyright (C) 1998-2000 Particle Physics and Astronomy Research
#   Council. All Rights Reserved.


