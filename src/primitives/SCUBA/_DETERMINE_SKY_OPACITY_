=head1 NAME

DETERMINE_SKY_OPACITY - find out the atmospheric extinction

=head1 SYNOPSIS

=head1 DESCRIPTION

Determine the atmospheric optacity (tau) for each wavelength
associated with the current frame.

This can be calculated in a number of ways.

  1. Determine from the CSO tau stored in the file.

  2. Determine from the most recent Skydip (not yet implemented)

  3. Retrieved from the pipeline modification text file (NYI)

  4. Derive high frequency tau value from nearest low frequency
     skydip (NYI)

Default method is to use CSO.

=head1 TASKS

No monoliths required for this primitive.

=head1 VARIABLES EXPORTED

Export the tau value for each wavelength.
Stored in %_DETERMINE_SKY_OPACITY_ and keyed by sub-instrument name.

=head1 EXTERNAL MODULES

Requires use of the C<JCMT::Tau> module to determine the 
tau ratios.

=cut

use JCMT::Tau;


foreach $filt ($Frm->filters) {

  $csotau = $Frm->hdr('TAU_225');
  ($tau, $status)  = get_tau($filt, 'CSO', $csotau);

  # Store the tau
  $_DETERMINE_SKY_OPACITY_{$filt} = $tau;

  print colored ("ORAC says: Using tau=$tau for $filt filter\n", 'magenta');
}
