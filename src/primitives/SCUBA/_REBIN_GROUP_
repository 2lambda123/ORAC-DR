=head1 NAME

REBIN_GROUP

=head1 DESCRIPTION

Rebin all the group data.

=head1 TASKS

SURF: REBIN

=head1 INPUT ARGUMENTS

REBIN_METHOD - Method to use for regrid. Allowed options are
               BESSEL, LINEAR, GAUSSIAN, SPLINE1, SPLINE2, MEDIAN

PIXEL_SIZE   - Pixel size in arcseconds

=cut


# Check that we are processing the last frame of the group
if ($Grp->lastmember($Frm)) {
 
  # Loop over sub instruments that are found in the current frame
  foreach $sub ($Frm->subs) {


    # Now need to find all the input frames for this sub-instrument
    # that are part of this group
 
    @members = $Grp->membernamessub($sub);

    # Create a text file containing lists of all files to be
    # Rebinned. Also add SHIFTS and WEIGHTS although we assume
    # that the weight and shifts are always 1 0 0 respectively

    $infile = "rebin_$$.lis";
    open (INPUT, "> $infile") || die "Error opening scratch file $!";
    map { print INPUT "$_ 1 0 0\n"; } @members;
    close INPUT;

    # Now construct arguments for rebin
    # Read input arguments
    $method = ($_REBIN_GROUP_{REBIN_METHOD} || "gaussian");
    $pixsize = ($_REBIN_GROUP_{PIXEL_SIZE} || "3.0");

    # Output filename
    $out = $Grp->grpoutsub($sub);

    $args = "REBIN_METHOD=$method PIXSIZE_OUT=$pixsize noloop";

    # Print informative message
    print colored ("ORAC says: Rebinning sub-instrument $sub\n",'magenta');

    # Run rebin
    $Mon{surf_mon}->obeyw("rebin","ref=$infile out=$out $args accept");
   
    # Remove the scratch file
    unlink $infile;

  }

}
