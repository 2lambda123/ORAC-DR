=head1 NAME

CALIBRATE_DATA

=head1 DESCRIPTION

Multiply SCUBA data by the gain.
The value for the gain depends on the filter.
This is a Frame operation and should be used before
group operations.

Currently the calibration is identical for all observations.

=head1 TASKS

Kappa: CMULT

=cut


# Need to loop over sub-instruments

@filter = $Frm->filters;


# Loop over sub-instruments
for my $i (1..$Frm->nfiles) {

  # Retrieve the current gain value from the calibration
  # object. This will calibrate our data in Jy and then
  # if we multiply by an extra 1000 we get mJy
  my $gain = $Cal->gain($filter[$i-1]) * 1000.0;

  # retrive input and output names
  my ($in, $out) = $Frm->inout("_cal", $i);
  
  my $args = "scalar=$gain";

  # Multiply by the gain
  $Mon{kappa_mon}->obeyw("cmult","in=$in out=$out $args");

  # Update file
  $Frm->file($i, $out);

}

orac_print "ORAC says: Data calibrated in mJy\n";
