=head1 NAME

CALIBRATE_DATA

=head1 DESCRIPTION

Multiply SCUBA data by the gain.
The value for the gain depends on the filter.
This is a Frame operation and should be used before
group operations.

Currently the calibration is identical for all observations.

=head1 TASKS

Kappa: CMULT

=cut


# Need to loop over sub-instruments

@filter = $Frm->filters;


# Loop over sub-instruments
for ($i = 0; $i < $Frm->nsubs; $i++) {

  # Retrieve the current gain value from the calibration
  # object. This will calibrate our data in Jy and then
  # if we multiply by an extra 1000 we get mJy
  $gain = $Cal->gain($filter[$i]) * 1000.0;

  # retrive input and output names
  ($in, $out) = $Frm->inout("_cal", $i+1);
  
  $args = "scalar=$gain";

  # Multiply by the gain
  $Mon{kappa_mon}->obeyw("cmult","in=$in out=$out $args");

  # Update file
  $Frm->file($i+1, $out);

}

print colored ("ORAC says: Data calibrated in mJy\n", 'magenta');
