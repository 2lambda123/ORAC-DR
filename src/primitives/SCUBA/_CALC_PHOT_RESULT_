=head1 NAME

CALC_PHOT_RESULT

=head1 DESCRIPTION

Process photometry integrations and calculate result.

=head1 TASKS

SURF: SCUPHOT
KAPPA: STATS

=head1 ARGUMENTS

METHOD = analysis method. AVERAGE, PARABOLA or SAMPLES
         Default is AVERAGE


=head1 Perl MODULES

NDF

=cut


# Check that we are a PHOTOM observation

if ($Frm->hdr('MODE') eq "PHOTOM") {

  # Read arg
  my $mode = ($_CALC_PHOT_RESULT_{METHOD} || 'average');

  for my $i (1..$Frm->nfiles) {
 
    # Find the filename
    my ($in, $out) = $Frm->inout("_pht", $i);

    # Arguments
    my $args = "ANALYSIS=$mode file=! accept";

    # Execute the action
    $Mon{surf_mon}->obeyw("scuphot", "in=$in out=$out $args");
 
    # Update filename
    $Frm->file($i, $out);
 
  }

  orac_print "ORAC says: Photometry data processed.\n";

  # Store the reduction mode in the header for later retrieval
  # Need to know later for when we calculate the NEFD
  # Just need to distinguish between SAMPLES and INTS
  if ($mode =~ /^sam/) {
    $Frm->uhdr('PHOTOM_METHOD', 'SAMPLES');
  } else {
    $Frm->uhdr('PHOTOM_METHOD', 'INTS');
  }

}
