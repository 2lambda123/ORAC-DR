=head1 NAME

REMOVE_SKY_JIGGLE

=head1 DESCRIPTION

Perform sky removal on jiggle data

=head1 TASKS

REMSKY from SURF

=head1 INPUT ARGUMENTS

MODE - sky removal mode
ADD  - Add background level back on (default no for photom else yes)

=head1 OUTPUT VARIABLES

None

=head1 INPUT VARIABLES

Uses $_DETERMINE_SKY_BOLOMETERS_JIGGLE{BOL$subname} 


=cut

# Check that we have an array

if ($Frm->hdr('SUB_1') eq 'LONG' || $Frm->hdr('SUB_1') eq 'SHORT') {

  @subs = $Frm->subs;
  $mode = ($_REMOVE_SKY_JIGGLE_{MODE} || "median");
  $add  = ($_REMOVE_SKY_JIGGLE_{ADD} || "no");

  # Loop over sub-instruments
  for ($i = 0; $i < $Frm->nsubs; $i++) {

    $bolometers = ($_DETERMINE_SKY_BOLOMETERS_JIGGLE_{"BOL".$subs[$i]} || "all");

    $params = "mode=$mode bolometers=$bolometers add=$add accept";

    # Find the filename
    ($in, $out) = $Frm->inout("_sky", $i+1);

    # Run REMSKY
    $Mon{surf_mon}->obeyw("remsky", "in=$in out=$out $params");

    print colored("ORAC says: Sky removed from $in using bolometers=$bolometers mode=$mode\n", 'magenta');
    
    # Update file name
    $Frm->file($i+1, $out);

  }

}
