=head1 NAME

DISPLAY_PHOTOM_GROUP

=head1 DESCRIPTION

Displays photometry data reduced for the current group.
Similar to SURF QDRAW.

=head1 TASKS

Kappa: LINPLOT, DRAWSIG, STATS

=cut


# Check that we are processing the last frame of the group
if ($Grp->lastmember($Frm)) {

  # Counter for XW devices
  $count = 0;

  # Loop over sub instruments that are found in the current frame
  foreach $sub ($Frm->subs) {
 

    # Find out the input group filename for this sub
    # The output filename is simply the group file name
    # with the sub-instrument (lower case) added.
    # Should formalise this since I am doing it a lot
    $in = $Grp->grpoutsub($sub);

    # Need to find range of plot by calling stats (I know this
    # is probably not very efficient since I ran STATS in the
    # previous primitive). Am tryign to make this standalone
    # Run STATS
    $Mon{kappa_mon}->obeyw("stats","ndf=$in");

    ($ORAC_STATUS, $mean) = $Mon{kappa_mon}->get("stats","mean");
    ($ORAC_STATUS, $sigma) = $Mon{kappa_mon}->get("stats","sigma");

    # Use 5 sigma
    $nsig = 5.0;
    $max = $mean + ($nsig * $sigma);
    $min = $mean - ($nsig * $sigma);



    # Determine arguments for LINPLOT
    # Device name is xwindows but need one for each subinst
    $count++;
    $device = ( $count == 1 ? "xw" : "x${count}w");

    $title = $Frm->hdr(OBJECT) . " ($sub)";
    $args = "mode=2 device=$device pltitl='$title' ordlim=[$min,$max] abslim=!";
    $axargs = "axlim=true ordlim=[$min,$max] abslim=!";

    # Run linplot
    $Mon{kapview_mon}->obeyw("linplot","ndf=$in $args $axargs");

    # Run drawsig
    $args = "linestyle=2 sigcol=red nsigma=[0,3] device=$device";
    $Mon{kapview_mon}->obeyw("drawsig","$args");


  }

}
