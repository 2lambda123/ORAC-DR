# -*-perl-*-

=head1 NAME

_SET_TAG_ - Tag the current Frame for subsequent retrieval.

=head1 DESCRIPTION

This primitive can be used to tag the current Frame for subsequent
retrieval. In conjunction with the _RETRIEVE_TAG_ primitive, this
primitive can be used to "jump back" to a previous step in processing.

=head1 ARGUMENTS

=over 4

=item TAG = STRING (Given)

The string to tag the current Frame with. This argument is mandatory,
and an error will be thrown if it is not defined.

=back

=head1 NOTES

=over 4

=item *

This primitive is suitable for any Frame.

=back

=head1 OUTPUT DATA

=over 4

=item *

None.

=back

=head1 TASKS

None.

=head1 REQUIRED PERL MODULES

None.

=head1 AUTHORS

Brad Cavanagh E<lt>b.cavanagh@jach.hawaii.eduE<gt>

=head1 COPYRIGHT

Copyright (C) 2008 Science and Technology Facilities
Council.  All Rights Reserved.

=cut

my $tag = $_PRIM_ARGS_->{TAG};
if( ! defined( $tag ) ) {
  orac_throw "TAG argument not defined in _SET_TAG_: Programming error.\n";
}

$Frm->tagset( $tag );

my %product = ( uc( $tag ) => $Frm->product );
if( defined( $Frm->uhdr( "TAG_PRODUCT" ) ) ) {
  %product = ( %product,
               %{$Frm->uhdr( "TAG_PRODUCT" )} );
}

$Frm->uhdr( "TAG_PRODUCT", \%product );
