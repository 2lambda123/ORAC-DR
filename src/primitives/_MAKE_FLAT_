# _MAKE_FLAT_
#
# Forms a flat-field. 
#
# TASK: CCDPACK - MAKEFLAT
#
# This should only be performed on OBJECT frames.
if ($Frm->hdr(OBSTYPE) =~ /OBJECT/) {

# Can generate a flat field and mosaic when there are at least three
# object frames.
   if ($Grp->num >= 2 ) {

# Form a list of input file names for MAKEFLAT from the other members
# of the group.
      $objlist = join(",",$Grp->membernames);

# Assign the other parameters.  Note that the dark and output flat are
# hardwired for the moment.

      $out='flat'.$Grp->name;
      $hidden = "method=median"; 

# Median filter of the debiassed and dark-corrected object frames to
# produce the flatfield.
      $Mon{"ccdpack_red"}->obeyw("makeflat","in='$inlist' out=$out $hidden reset accept");

# set flat

$Cal->flat($out);

#
      print colored ("Orac says: frames $objlist used to make flat\n",'magenta');
   };
};
