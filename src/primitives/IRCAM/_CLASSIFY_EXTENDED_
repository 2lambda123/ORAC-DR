# _CLASSIFY_EXTENDED_         -*- perl -*-
#
# Classifies object frames into target and sky for extended sources.
#
# TASK: CCDPACK - FLATCOR
#
# Arguments:
#    SKY_FREQ = INTEGER (Given)
#       The frequency of the sky frames.  Thus if the object and sky
#       alternate this is 2.  The minimum is also 2. [2]
#
# This should only be performed on OBJECT frames.
    if ($Frm->hdr(OBSTYPE) =~ /OBJECT/ ||
        $Frm->hdr(OBSTYPE) =~ /SKY/) {

# Obtain the cycle frequency of skies.  A value of 2 means the object and
# sky frames alternate.  This assumes a sequence: cycle-1 object frames,
# sky frame, cycle-1 object frames, sky frame,...
       $cycle = max( 2, ( $_CLASSIFY_EXTENDED_{SKY_FREQ} || 2 ) );

# Record the frequency in the frame headers.
       $Frm->hdr( "SKY_FREQ", $cycle );

# Classify this frame as either a target or blank-sky object frame.
       if ( ($Grp->num + 1) % $cycle == 0 ) {
          $Frm->hdr( "TARGET_OR_SKY", "sky" );
          $filename = $Frm->file;
          orac_print "Orac says: $filename is of blank sky.\n";

       } else {
          $Frm->hdr( "TARGET_OR_SKY", "target" );
          $filename = $Frm->file;
          orac_print "Orac says: $filename is of the target.\n";
       }

    }
