# _MAKE_FLAT_EXTENDED_      -*-perl-*-
#

# Obtain the cycle frequency of skies.  A value of 2 means the object and
# sky frames alternate.
    $cycle = $Frm->hdr( "SKY_FREQ" );

# Test whether or not this is an object frame or a sky frame. 
    $class = $Frm->hdr( "TARGET_OR_SKY" );

# Only perform this on sky frames.  This is an added check for all but
# _MASK_DEVIANTS_.  The other primitives called ought to do this for
# themselves.
    if ( $class =~ /sky/ ) {

# Mask deviant pixels, such as cosmic rays, form the sky frame.
       _MASK_DEVIANTS_

# Normalise the sky frames to each other.
       _NORMALISE_TO_MODE_EXTENDED_

# Make an approximate flat field.  Any faint sources present will bias
# the flat field.
       _MAKE_FLAT_FROM_NORMALISED_EXTENDED_
    }
