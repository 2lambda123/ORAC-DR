# _SUBTRACT_SKY_          -*-perl-*-
#
# Subtracts a bias frame
#
# TASK: CCDPACK - CALCOR
#
# This should only be performed on OBJECT frames.
    if ($Frm->hdr(OBSTYPE) =~ /OBJECT/ || $Frm->hdr(OBSTYPE) =~ /SKY/) {

# Estimate the sky.
       _CLIPPED_MEAN_ CLIP=[2,2.5,3,3]
       $sky = $_CLIPPED_MEAN_{RESULT};

# Generate the input and output filenames.  The output file has the same
# name as the input except the suffix is changed to indicate it has been
# sky subtracted.
       ($in,$out) = $Frm->inout("_ss");
       $header = "in=$in scalar=$sky out=$out title=\'Sky subtracted\'";

# Subtract the modal sky value obtained from the frame itself.
       $Mon{"kappa_mon"}->obeyw("csub","$header");

# Report the processing status.
       orac_print "Orac says: $in to $out: sky subtracted\n";

# Now update the output filename in the Frame object.
       $Frm->file($out);

# Display the image.
       _DISPLAY_FRAME_IMAGE_

    };
