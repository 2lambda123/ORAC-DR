# _NOD_SELF_FLAT_TIDY_      -*- perl -*-
#
# Removes unwanted intermediate files for the NOD_SELF_FLAT recipe
# variants.
    
# Removed intermediate files stored $Frm->file method.
    _DELETE_TEMP_FILES_ KEEP=_dk,_dp,_ff

# Certain files can only be removed once certain steps are complete,
# and then only as a group.  So determine if it's time to remove these
# files.  Since the flat may only be created after the first cycle, use
# the FLAT_DIVIDE steering parameter, as this is activated every cycle.
# Obtain the cycle number too.
    my $flatdivide = $Frm->hdr( "FLAT_DIVIDE" );
    my $mademosaic = $Frm->hdr( "MAKE_MOSAIC" );
    my $cycleno = $Frm->hdr( "CYCLE_NUMBER" ); 

# Remove the remaining files from this cycle used to make the flat.
    if ( $flatdivide ) {
       _DELETE_TEMP_GROUP_FILES_ DELETE=_dk
    }

# Remove the remaining files from this cycle used to make the mosaic.
# Note these are in the difference-pair group.
    if ( $mademosaic ) {
       {

# Make a local version of the main group, using the group of
# differenced pairs.  Then use the standard primitive which expects
# a $Grp.
          my $Grp = $Grp->uhdr( "DIFFERENCE_GROUP" );
          my $mosGrp = $Grp->subgrp( CYCLE_NUMBER => $cycleno );
          {
             my $Grp = $mosGrp;
             my $Frm = $Grp->frame( $Grp->num - 1 );
             _DELETE_TEMP_GROUP_FILES_ DELETE=_dp,_trn
          }
       }
    }
