# _SKY_AND_JITTER_STEER_
#
# Control processing for SKY+JITTERn recipes, in particular when to
# file and subtract the sky, and when to make a mosaic.  For the time
# being hardwire to every fifth.  (Will be every n+1th frame once
# parameter passing is working.)
#
# Arguments:
#    NUMBER = INTEGER (Given)
#       The number of frames in the jitter.  It excludes the sky
#       frame.  The minimum number is 3. [5]
#
# This should only be performed on OBJECT frames.
    if ( $Frm->hdr( "OBSTYPE" ) eq "OBJECT" ||
         $Frm->hdr( "OBSTYPE" ) eq "SKY" ) {

# Obtain the number of frames in the jitter pattern and sky frequency.
       my $number = max( 3, ( $_SKY_AND_JITTER_STEER_{NUMBER} || 5 ) );
       my $cycle = $number + 1;
       my $seqnum = $Grp->num % $cycle;

# Specify when to file and subtract the sky frame.  Distinguish sky and
# target frames for some primitives.  The first frame is sky, followed by
# NUMBER jitters. 
       if ( $seqnum == 0 ) {
          $Frm->hdr( "FILE_SKY", 1 );
          $Frm->hdr( "TARGET_OR_SKY", "sky" );
          $Frm->hdr( "SUBTRACT_SKY", 0 );
       } else {
          $Frm->hdr( "FILE_SKY", 0 );
          $Frm->hdr( "TARGET_OR_SKY", "target" );
          $Frm->hdr( "SUBTRACT_SKY", 1 );
       }

# Specify during processing of which frames should the objects masked,
# a mosaic created, and aperture photometry performed.
       if ( $seqnum == $number ) {
          $Frm->hdr( "MAKE_MOSAIC", 1 );
          $Frm->hdr( "DO_APHOT", 1 );

       } else {
          $Frm->hdr( "MAKE_MOSAIC", 0 );
          $Frm->hdr( "DO_APHOT", 0 );
       }

    }
