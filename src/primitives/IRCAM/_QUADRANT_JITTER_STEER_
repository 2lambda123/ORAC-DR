# _QUADRANT_JITTER_STEER_
#
# Control processing for QUADRANT_JITTER_FLAT, in particular when to
# make a flat and mosaic, mask objects, and which is the reference frame
# for normalisation. 
#
# This should only be performed on OBJECT frames.
    if ( $Frm->hdr( "OBSTYPE" ) eq "OBJECT" ) {

# Specify the first frame as the frame whose mode will be the
# reference for the normalisation of frames.
       if ( $Grp->num == 0 ) {
          $Frm->hdr( "REFERENCE_FRAME", 1 );
       } else {
          $Frm->hdr( "REFERENCE_FRAME", 0 );
       }

# Specify during processing of which frames should the flat be created,
# flat-field creation with objects masked, and a mosaic created.
       if ( ($Grp->num + 1) % 4 == 0 ) {
          $Frm->hdr( "MAKE_FLAT", 1 );
          $Frm->hdr( "MASK_OBJECTS", 1 );
          $Frm->hdr( "MAKE_MOSAIC", 1 );
       
       } else {
          $Frm->hdr( "MAKE_FLAT", 0 );
          $Frm->hdr( "MASK_OBJECTS", 0 );
          $Frm->hdr( "MAKE_MOSAIC", 0 );
       }

# Insert the cycle number of the set of four frames.
       $Frm->hdr( "CYCLE_NUMBER", int( $Grp->num / 4 ) );
    }
