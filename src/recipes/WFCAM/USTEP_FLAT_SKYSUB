#+
# Name:
#    USTEP_FLAT_SKYSUB

# Purpose:
#    Dark correct and flat field a microstep sequence. Subtract a sky
#    estimate derived from the frames themselves. Interleave and do an
#    astrometric and photometric calibration on the derived catalogue.

# Language:
#    Perl5

# Description:
#    This recipe does the following to a microstep sequence:
#       - Dark correction and flat field using pre-existing master frames
#       - Forms a mean sky frame from the images and subtracts it
#       - Interleaving
#       - Object extraction and classification
#       - WCS Fitting
#       - Photometric zero point calculation
#       - Filing of DQC information
#       - Display of the final dither frame.
#

# Notes:
#    None

# Output Data:
#    -  Interleaved super frames and confidence maps
#    -  All super frames are astrometrically and photometrically calibrated

# Configurable Steering Parameters:
#    None

# Timing:
#    {timing_information}

# Implementation Status:
#    -  The processing is all done with CIRDR routines.

# References:
#    None

# Related Recipes:
#    USTEP_FLAT

# Authors:
#    JRL: Jim Lewis (CASU)
#
# Copyright:
#    Copyright (C) 2004-2007 Cambridge Astronomical Survey Unit.
#    All Rights Reserved.
#
#-

# Get started

_WFCAM_HELLO_
_USTEP_ONLY_STEER_

# Edit the readnoise into the header

_READNOISE_HEDIT_

# Do the dark correction and flat fielding using master frames

_STAGE1_ DARKCOR=1 FLATCOR=1

# Edit the confidence map into the header

_CPM_HEDIT_

# Subtract the sky

_USTEP_SKYSUB_

# Do the interleaving, catalogue extraction and astrometric and photometric
# calibration

_INTERLEAVE_AND_CATALOGUE_


=head1 NAME

USTEP_FLAT_SKYSUB -- Dark correct and flat field a microstep sequence.
Subtract a sky estimate derived from the frames themseleves. Interleave
and do an astrometric and photometric calibration on the derived catalogue.

=head1 DESCRIPTION

This recipe does the instrumental signature processing on frames and
then various combinations. This includes:

=over 4

=item *

Dark correction and flat fielding using pre-existing master frames.

=item *

Forms a mean sky frame from the images and subtracts it

=item *

Interleaving

=item *

Object extraction and classification

=item *

WCS Fitting

=item *

Photometric zero point calculation

=item *

Filing of DQC information

=item *

Display of the final super frame.

=back

=head1 NOTES

=over 4

None

=head1 OUTPUT DATA

=over 4

=item *

Interleaved super frames and confidence maps

=item *

All combined frames are astrometrically and photometrically calibrated

=back

=head1 CONFIGURABLE STEERING PARAMETERS

None

=head1 IMPLEMENTATION STATUS

=over 4

=item *

All processing is done with CIRDR routines.

=item *

Files are in standard Multi-extension FITS.

=back

=head1 REFERENCES

None

=head1 RELATED RECIPES

L<USTEP_FLAT|USTEP_FLAT>

=head1 AUTHORS

Jim Lewis (CASU) (jrl@ast.cam.ac.uk)

=head1 COPYRIGHT

Copyright (C) 2004-2007 Cambridge Astronomical Survey Unit.
All Rights Reserved.

=cut


