# EXTENDED_OFFSET    -*-perl-*-

=head1 Name:
    EXTENDED_OFFSET

=head1 Purpose:
    Extended source standard reduction using offsets to register.

=head1 Language:
    perl5

=head1 Description: This script is an example how to reduce an
    extended source using IRCAM3 data.  It remains an example (using
    Stuart Ryder's exec) until a sensible exec is defined. It takes an
    IRCAM observation comprising a series of pairs of frames, each
    comprising the part of the source followed by a sky exposure; and
    a dark frame to make a calibrated, untrimmed mosaic automatically.

    It performs a null debiassing, bad-pixel masking, dark
    subtraction, flatfield division, sky subtraction, resampling using
    the offsets stored in the headers, and mosaicking.

    The flat field is derived from the sky frames as follows.  The mode
    (sigma-clipped mean) is used to offset each sky frame's mode to that
    of the first sky frame.  Using the selected combination method (-c)
    the corrected sky frames are combined pixel by pixel; the
    resultant frame is normalised by its median to form the flatfield.
    This median is subtracted from the source frames after they have
    been flat-fielded.

    The resampling comprises shifts of origin and rotation to align the
    y axis north-south.

=head1 References:
    "Scripts for UFTI" G.S. Wright & S.K. Leggett, 1997 orac009-ufts, v01.

    "" S.Ryder http://...
    
=head1 Authors:
    MJC: Malcolm J. Currie (UKATC)

# Startup
# =======
#
# Every recipe must do this.
    _IRCAM_HELLO_

# This gets done for the first frame in the sequence.
    _EXTENDED_OFFSET_HELLO_

# Calibration
# ===========
#
# The following operations are preformed for every appropriate frame.

# Add classification headers to discriminate between blank-sky and
# target object frames.  Also set the frequency of sky frames, through
# the SKY_FREQ argument, which defaults to 2.
    _CLASSIFY_EXTENDED_

# Apply the bad pixel mask.
    _MASK_BAD_PIXELS_

# Remove the bias.
    _REMOVE_BIAS_

# Subtract the dark frame.
    _SUBTRACT_DARK_

# Generate the flat field using the extended-source technique.
    _MAKE_FLAT_EXTENDED_

# Apply the flat field.
    _DIVIDE_BY_FLAT_FROM_EXTENDED_

# Subtract the sky
    _SUBTRACT_SKY_EXTENDED_

# Mosaicking
# ==========

# Determine the linear offsets between the object frames in the group
# by pattern matching common features.  Register the frames using a shift
# of pixel origin.
    _GENERATE_OFFSETS_EXTENDED_OFFSET_

# Apply rotation, resample each frame, and tesselate.  The mosaic is
# trimmed to the dimensions of an input frame.
    _MAKE_MOSAIC_EXTENDED_
 
