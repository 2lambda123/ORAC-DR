#+
# Name:
#    POINT_SOURCE_BASIC

# Purpose:
#    Reduces a point-source photometry observation using just the
#    basic operations for speed.

# Language:
#    Perl5

# Description:
#    This recipe reduces a jittered photometry observation
#    with IRCAM data.  It takes an IRCAM observation comprising a
#    series of nine object frames, an existing dark frame, and a
#    predetermined flat-field frame to make a calibrated, trimmed
#    mosaic automatically.

#    This recipe performs bad-pixel masking, null debiassing, dark
#    subtraction, flat-field division, integer shifts of origin to
#    register, and mosaicking.  See the notes for details.

#    As the name implies, it is intended for fainter point sources,
#    where using an existing flat gives adequate calibration and
#    speed is important.

# Notes:
#    -  You may use SKY_FLAT or SKY_FLAT_MASKED to make the flat field.
#    -  The bad pixel mask applied is $ORAC_DATA_CAL/bpm.
#    -  Registration is performed using the telescope offsets
#    transformed to pixels.
#    -  There is no resampling, merely integer shifts of origin.
#    -  The recipe makes the mosaic by applying offsets in intensity to
#    give the most consistent result amongst the overlapping regions.
#    The mosaic is trimmed to the dimensions of an input frame.  The
#    mosaic is not normalised by its exposure time (that being the
#    exposure time of a single frame).
#    -  For each cycle of nine, the recipe creates a mosaic, which
#    is then added into a master mosaic of improving signal to noise.
#    The exposure time is also summed and stored in the mosaic's
#    EXP_TIME header.  Likewise the end airmass header, AMEND, is
#    updated to match that of the last-observed frame contributing to
#    the mosaic.
#    -  Intermediate frames are deleted except for the flat-fielded (_ff
#    suffix) frames.
#    -  Sub-arrays are supported.

# Output Data:
#    -  The resultant mosaic in rg<date>_<group_number>_mos.
#    -  The individual flat-fielded frames in ro<date>_<obs_number>_ff.

# Configurable Steering Parameters:
#    NUMBER = INTEGER
#       The number of frames in the jitter pattern. [9]

# Timing:
#    This is a fast recipe and should keep pace with observations.

# Implementation Status:
#    -  The processing engines are from the Starlink packages: CCDPACK
#    and KAPPA.
#    -  Uses the Starlink NDF format.
#    -  History is recorded within the data files.
#    -  The title of the data is propagated through intermediate files
#    to the mosaic.
#    -  Error propagation is not used.

# References:
#    "Scripts for UFTI" G.S. Wright & S.K. Leggett, 1997 orac009-ufts, v01.

# Related Recipes:
#    BRIGHT_POINT_SOURCE, JITTER9_SELF_FLAT_BASIC, SKY_FLAT, SKY_FLAT_MASKED.

# Authors:
#    MJC: Malcolm J. Currie (UKATC/JAC)
#
# Copyright:
#    Copyright (C) 1998-2000 Particle Physics and Astronomy Research
#    Council.  All Rights Reserved.
#
#-

# Startup
# =======
#
# Every recipe must do this.
    _IRCAM_HELLO_

# This gets done for the first frame in sequence
    _BRIGHT_POINT_SOURCE_HELLO_

# Set up steering control of the processing, namely when to make a flat,
# make a mosaic.
    _BRIGHT_POINT_SOURCE_STEER_ NUMBER=9

# Calibration
# ===========
#
# The following operations are preformed for every appropriate frame.

# Apply the bad pixel mask.
    _MASK_BAD_PIXELS_

# Remove the bias.
    _REMOVE_BIAS_

# Subtract the dark frame.
    _SUBTRACT_DARK_

# Flat field using a pre-existing calibration frame.
    _DIVIDE_BY_FLAT_

# Determine the linear offsets between the object frames in the group
# from the telescope offsets.  Register the frames using a shift
# of pixel origin.
    _GENERATE_OFFSETS_JITTER_ TELEOFF=1

# Apply shifts of origin, and tesselate.  The mosaic is trimmed to
# the dimensions of an input frame.  Bad pixels are not filled.
    _MAKE_MOSAIC_ RESAMPLE=0 FILLBAD=0 TRIM=1

# Remove intermediate data files.
    _BRIGHT_POINT_SOURCE_TIDY_

# Podule
# ======

=head1 NAME

POINT_SOURCE_BASIC -- Reduces a point-source photometry observation using just the basic operations for speed.

=head1 DESCRIPTION

This recipe reduces a jittered photometry observation
with IRCAM data.  It takes an IRCAM observation comprising a
series of nine object frames, an existing dark frame, and a
predetermined flat-field frame to make a calibrated, trimmed
mosaic automatically.

This recipe performs bad-pixel masking, null debiassing, dark
subtraction, flat-field division, integer shifts of origin to
register, and mosaicking.  See the notes for details.

As the name implies, it is intended for fainter point sources,
where using an existing flat gives adequate calibration and
speed is important.

=head1 NOTES

=over 4

=item * 

You may use L<SKY_FLAT|SKY_FLAT> or L<SKY_FLAT_MASKED|SKY_FLAT_MASKED> 
to make the flat field.

=item *

The bad pixel mask applied is F<$ORAC_DATA_CAL/bpm>.

=item * 

Registration is performed using the telescope offsets
transformed to pixels.

=item *

There is no resampling, merely integer shifts of origin.

=item * 

The recipe makes the mosaic by applying offsets in intensity to
give the most consistent result amongst the overlapping regions.
The mosaic is trimmed to the dimensions of an input frame.  The
mosaic is not normalised by its exposure time (that being the
exposure time of a single frame).

=item *

For each cycle of nine, the recipe creates a mosaic, which
is then added into a master mosaic of improving signal to noise.
The exposure time is also summed and stored in the mosaic's
EXP_TIME header.  Likewise the end airmass header, AMEND, is
updated to match that of the last-observed frame contributing to
the mosaic.

=item *

Intermediate frames are deleted except for the flat-fielded (_ff
suffix) frames.

=item *

Sub-arrays are supported.

=back

=head1 OUTPUT DATA

=over 4

=item *

The resultant mosaic in rgE<lt>dateE<gt>_E<lt>group_numberE<gt>_mos.

=item *

The individual flat-fielded frames in roE<lt>dateE<lt>_E<lt>obs_numberE<gt>_ff.

=back

=head1 CONFIGURABLE STEERING PARAMETERS

=over 4

=item NUMBER = INTEGER

The number of frames in the jitter pattern. [9]

=back

=head1 TIMING

This is a fast recipe and will keep pace with observations.

=head1 IMPLEMENTATION STATUS

=over 4

=item *

The processing engines are from the Starlink packages: CCDPACK
and KAPPA.

=item *

Uses the Starlink NDF format.

=item *

History is recorded within the data files.

=item *

The title of the data is propagated through intermediate files
to the mosaic.

=item *

Error propagation is not used.

=back

=head1 REFERENCES

"I<Scripts for UFTI>" G.S. Wright & S.K. Leggett, 1997 orac009-ufts, v01.

=head1 RELATED RECIPES

L<BRIGHT_POINT_SOURCE|BRIGHT_POINT_SOURCE>,
L<JITTER9_SELF_FLAT|JITTER9_SELF_FLAT>,
L<SKY_FLAT|SKY_FLAT>,
L<SKY_FLAT_MASKED|SKY_FLAT_MASKED>.

=head1 AUTHORS

Malcolm J. Currie (UKATC/JAC) (mjc@jach.hawaii.edu)

=head1 COPYRIGHT

Copyright (C) 1998-2000 Particle Physics and Astronomy Research
Council.  All Rights Reserved.

=cut

