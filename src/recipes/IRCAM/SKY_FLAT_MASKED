# SKY_FLAT_MASKED    -*-perl-*-
#
# Recipe to make a sky flat from a series of object frames (these may
# include blank sky) combined using one of a selection of statistics.
# It expects a suitable dark frame to be available.
#
# It performs a null debiassing, bad-pixel masking, and dark subtraction
# before combining normalised frames pixel by pixel using a clipped
# median statistic.  The clipping comprises three rejections at two
# sigma.  The flat is applied to the frames.  Any significant objects
# are detected, and masked, and a new flat is derived.

# Startup
# =======
#
# Every recipe must do this.
    _IRCAM_HELLO_

# This gets done for the first frame in sequence
    _SKY_FLAT_HELLO_

# Calibration
# ===========
#
# The following operations are preformed for every appropriate frame.

# Apply the bad pixel mask.
    _MASK_BAD_PIXELS_

# Remove the bias.
    _REMOVE_BIAS_

# Subtract the dark frame.
    _SUBTRACT_DARK_

# Form flat field
# ===============

# This is only done one there are at least three object frames.
    _MAKE_FLAT_FROM_MASKED_GROUP_
