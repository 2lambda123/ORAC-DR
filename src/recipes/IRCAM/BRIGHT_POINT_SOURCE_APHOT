#+
# Name:
#    BRIGHT_POINT_SOURCE_APHOT

# Purpose:
#    Reduces a bright-point-source photometry observation and performs
#    aperture photometry.

# Language:
#    Perl5

# Description:
#    This recipe reduces a "bright standard" photometry observation
#    with IRCAM data.  It takes an IRCAM observation comprising a
#    series of object frames and a dark frame with a predetermined
#    flat-field frame to make a calibrated, trimmed mosaic
#    automatically.

#    This recipe performs a null debiassing, bad-pixel masking, dark
#    subtraction, flat-field division, feature detection and matching
#    between object frames, and resampling. 

#    Photometry of the point source using a fixed 6 arcsecond aperture
#    is calculated for each jitter frame and the mosaic.  The results
#    appear in $ORAC_DATA_OUT/aphot_results.txt in the form of a Starlink
#    small text list.  The analysis of each star is appended to this file.

# Notes:
#    -  You may use SKY_FLAT or SKY_FLAT_MASKED to make the flat field.
#    -  Where automatic registration is not possible, the recipe matches
#    the centroid of central source, and should that fail, it resorts
#    to using the telescope offsets transformed to pixels.
#    -  The resampling applies non-integer shifts of origin.
#    -  The recipe makes the mosaic by applying offsets in intensity to
#    give the most consistent result amongst the overlapping regions.
#    -  The photometry tabulation includes the file name, source name,
#    time, filter, airmass, the catalogue magnitude and estimates of
#    the zero-point with and without the application of a mean
#    extinction.  There are headings at the top of each column.

# References:
#    "Scripts for UFTI" G.S. Wright & S.K. Leggett, 1997 orac009-ufts, v01.

# Related Recipes:
#    BRIGHT_POINT_SOURCE, SKY_FLAT, SKY_FLAT_MASKED.

# Authors:
#    MJC: Malcolm J. Currie (UKATC)
#
#-

# Startup
# =======
#
# Every recipe must do this.
    _IRCAM_HELLO_

# This gets done for the first frame in sequence
    _BRIGHT_POINT_SOURCE_HELLO_

# Set up steering control of the processing, namely when to make a flat,
# make a mosaic.
    _BRIGHT_POINT_SOURCE_STEER_

# Calibration
# ===========
#
# The following operations are preformed for every appropriate frame.

# Apply the bad pixel mask.
    _MASK_BAD_PIXELS_

# Remove the bias.
    _REMOVE_BIAS_

# Subtract the dark frame.
    _SUBTRACT_DARK_

# Flat field using a pre-existing calibration frame.
    _DIVIDE_BY_FLAT_

# Determine the linear offsets between the object frames in the group
# by pattern matching common features.  Register the frames using a shift
# of pixel origin.
    _GENERATE_OFFSETS_JITTER_

# Apply rotation, resample each frame, and tesselate.  The mosaic is
# trimmed to the dimensions of an input frame.
    _MAKE_MOSAIC_

# Compute approximate magnitude using aperture photometry.  Use the
# standard zero point, and extinction coefficient for the filter.
    _APHOT_MAG_

# Remove intermediate data files.
    _BRIGHT_POINT_SOURCE_TIDY_

# Podule
# ======

=head1 Name:

BRIGHT_POINT_SOURCE_APHOT

=head1 Purpose:

Reduces a bright-point-source photometry observation and performs
aperture photometry.

=head1 Language:

Perl5

=head1 Description:

This recipe reduces a "bright standard" photometry observation
with IRCAM data.  It takes an IRCAM observation comprising a
series of object frames and a dark frame with a predetermined
flat-field frame to make a calibrated, trimmed mosaic
automatically.

This recipe performs a null debiassing, bad-pixel masking, dark
subtraction, flat-field division, feature detection and matching
between object frames, and resampling. 

Photometry of the point source using a fixed 6 arcsecond aperture
is calculated for each jitter frame and the mosaic.  The results
appear in F<$ORAC_DATA_OUT/aphot_results.txt> in the form of a Starlink
small text list.  The analysis of each star is appended to this file.

=head1 Notes:

=item *  You may use SKY_FLAT or SKY_FLAT_MASKED to make the flat field.
=item *  Where automatic registration is not possible, the recipe matches
the centroid of central source, and should that fail, it resorts
to using the telescope offsets transformed to pixels.
=item *  The resampling applies non-integer shifts of origin.
=item *  The recipe makes the mosaic by applying offsets in intensity to
give the most consistent result amongst the overlapping regions.
=item *  The photometry tabulation includes the file name, source name,
time, filter, airmass, the catalogue magnitude and estimates of
the zero-point with and without the application of a mean
extinction.  There are headings at the top of each column.

=head1 References:

"I<Scripts for UFTI>" G.S. Wright & S.K. Leggett, 1997 orac009-ufts, v01.

=head1 Related Recipes:

L<BRIGHT_POINT_SOURCE>, L<SKY_FLAT>, L<SKY_FLAT_MASKED>.

=head1 Authors:

Malcolm J. Currie (UKATC)

=cut
