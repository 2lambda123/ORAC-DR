# SKY_AND_JITTER5_APHOT -*-perl-*-

=head1  Name:
     SKY_AND_JITTER5_APHOT

=head1  Purpose:
     Reduces a 5-point "combined jitter" photometry observation.

=head1  Language:
     perl5

=head1  Description:
     This script reduces a "combined jitter" photometry observation
     with IRCAM3 data.  It takes an IRCAM observation comprising a one or
     more sets of frames, each set containing a sky frame, followed by
     five object frames; and a pre-determined flat-field frame to make
     a calibrated, trimmed mosaic automatically.  It then performs
     aperture photometry of the point source using a minimum aperture of
     6 arcsec.

     It performs a null debiassing, bad-pixel masking, sky subtraction,
     flatfield division, feature detection and matching between object
     frames, resampling, and mosaicking.  The most-recent sky frame is
     used for the sky subtraction.  The resampling comprises
     shifts of origin and rotation to align the y axis north-south.

# Startup
# =======
#
# Every recipe must do this.
    _IRCAM_HELLO_

# Initialisation for the recipe.
    _SKY_AND_JITTER_HELLO_

# Set up steering control of the processing, namely when to file and subtract
# a sky, and when to make a mosaic.
    _SKY_AND_JITTER_STEER_ NUMBER=5

# Calibration
# ===========
#
# The following operations are preformed for every appropriate frame.

# Apply the bad pixel mask.
    _MASK_BAD_PIXELS_

# Remove the bias.
    _REMOVE_BIAS_

# File the first frame and every sixth frame therreafter as a blank-sky
# calibration.
    _FILE_SKY_SKY_AND_JITTER_

# Subtract the sky frame.
    _SUBTRACT_SKY_SKY_AND_JITTER_

# Flat field using a pre-existing calibration frame.
    _DIVIDE_BY_FLAT_

# Make mosaic
# ===========

# Determine the linear offsets between the object frames in the group
# by pattern matching common features.  Register the frames using a shift
# of pixel origin.
    _GENERATE_OFFSETS_SKY_AND_JITTER_

# Apply rotation, resample each frame, and tesselate.  The mosaic is
# trimmed to the dimensions of an input frame.
    _MAKE_MOSAIC_SKY_AND_JITTER_

# Compute approximate magnitude using aperture photometry.  Use the
# standard zero point, and extinction coefficient for the filter.
    _APHOT_MAG_
