# JITTER5_SELF_FLAT_NO_MASK -*-perl-*-

=head1  Name:
     JITTER5_SELF_FLAT_NO_MASK

=head1  Purpose:
     Reduces a 5-point "standard jitter" photometry observation.

=head1  Language:
     perl5

=head1  Description:
     This script reduces a "standard jitter" photometry observation
     with IRCAM3 data.  It takes an IRCAM observation comprising five
     object frames and a dark frame to make a calibrated, untrimmed
     mosaic automatically.

     It performs a null debiassing, bad-pixel masking, dark
     subtraction, flatfield creation, flatfield division, feature
     detection and matching between object frames, resampling, and
     mosaicking.

     The flat field is created by combining normalised object frames
     using the clipped median at each pixel.

     The resampling comprises shifts of origin and rotation to align
     the y axis north-south.  The mosaic is not restricted to the bounds
     of the central frame of the jitter.

# Startup
# =======
#
# Every recipe must do this.
    _IRCAM_HELLO_

# This gets done for the first frame in sequence.
    _JITTER_SELF_FLAT_HELLO_

# Set up steering control of the processing, namely when to make a flat,
# and make a mosaic.
    _JITTER_SELF_FLAT_STEER_ NUMBER=5

# Calibration
# ===========
#
# The following operations are performed for every appropriate frame.

# Apply the bad-pixel mask.
    _MASK_BAD_PIXELS_

# Remove the bias.
    _REMOVE_BIAS_

# Subtract the dark frame.
    _SUBTRACT_DARK_

# Generate an approximate flat field by using the object frames.
# Apply the flat field.   No object masking is applied.
    _FLAT_FIELD_MASKED_GROUP_ MASK=0

# Mosaicking
# ==========

# Determine the linear offsets between the object frames in the group
# by pattern matching common features.  Register the frames using a shift
# of pixel origin.
    _GENERATE_OFFSETS_

# Apply rotation, resample each frame, and tesselate.  The mosaic is
# not trimmed to the dimensions of an input frame.
    _MAKE_MOSAIC_NO_BOUND_
