
=head1 Name

REDUCE_FLAT -- Reduces an IFU flat field

=head1 Description

Reduces an IFU flat-field spectrum (taken using the UIST Calibration
unit grey-body or halogen lamp). The normalised flat is filed with the
calibration system. The flat field frame is also used to measure the
positions of the slices on the array (they are shifted vertically by
different amounts for different grisms). This too is filed with the
calibration system.

The separate slice spectra are extracted from the frame and rearranged
in a new 2d frame in the correct order (the order in which they cover
the 2d field of view) and approximately aligned in the spectral axis. This 
produces a frame that looks more like a long slit spectrum.

The frame is now treated as a standard long-slit spectrum. The image is
collapsed in the y direction, a polynomial is fitted to this and then
grown into an image. This is used to remove the characteristics of the
lamp from the flat-field (this does not have to be done precisely because
the same flat-field is used for object frames and flux calibrators, so
it cancels out anyway). The image is normalised to have a mean value of 1.
The flat field is filed with the calibration system.

=head1 Note

The flat-field accounts for the difference in transmission from one
slice to another as well as pixel to pixel variation. The values in
the flat-field can therefore vary significantly from one slice to
another.

=head1 Authors

Stephen Todd <spt@roe.ac.uk>

=head1 Copyright

Copyright (C) 1998-2002 Particle Physics and Astronomy Research
Council.  All Rights Reserved.

=cut

_MEASURE_OFFSET_
_REDUCE_SINGLE_FRAME_ NOFLAT=1 NOARC=1 NOCUBE=1

_SPECTROSCOPY_MODE_
_NORMALIZE_FLAT_BY_POLY_ 
_FILE_FLAT_
_IFU_MODE_


