#+
# Name:
# MAKE_ARC
#
# Purpose:
#    Reduces an IFU arc spectrum 
#
# Language:
#    Perl5
#
# Description:
#    This recipe takes an IFU arc spectrum. It performs bad pixel masking,
#    dark/bias subtraction, and flat-fielding.
#
#    The locations of the slices and the approximate shifts that should be 
#    applied to them are obtained from calibration files and written into the
#    header of the file by _LOCATE_SLICES_. These are used by _EXTRACT_SLICES_
#    to extract the slices and put them into another 2d image in the correct
#    order (the order in which they cover the 2d field of view) and 
#    approximately aligned in the spectral axis. 
#
#    The Figaro IARC task is used to obtain a wavelength calibration for each
#    row, which is filed with the calibration system for use by subsequent 
#    primitives. Finally all the rows are scrunched to a common, linear 
#    wavelength scale to allow the observer to check that the wavelength 
#    calibration was correct (ie that the spectra are now straight). 
#
# Notes:
#    - The variance array should be propagated through the pipeline.
#    - Bad pixels are filled before any resampling to prevent them spreading.
#
# Authors:
#    Stephen P. Todd (Edinburgh University/UKATC)
#
# Copyright:
#    Copyright (C) 1998-2002 Particle Physics and Astronomy Research
#    Council.  All Rights Reserved.
#
#-


_UIST_HELLO_

# Switch to spectroscopy mode to use _MASK_BAD_PIXELS_
_SPECTROSCOPY_MODE_
_ADD_READNOISE_VARIANCE_
_ADD_POISSON_VARIANCE_
_SUBTRACT_BIAS_
_MASK_BAD_PIXELS_
_IFU_MODE_  

_COVER_BAD_ROWS_
_LOCATE_SLICES_
_EXTRACT_SLICES_ 

# Switch to spectroscopy mode to use _DIVIDE_BY_FLAT_
_SPECTROSCOPY_MODE_
_DIVIDE_BY_FLAT_
_IFU_MODE_  
_FILL_BAD_PIXELS_
_IARC_
_ISCRUNCH_


# Podule
# ======

=head1 Name

MAKE_ARC -- Reduces an IFU arc spectrum

=head1 Description

This recipe takes an IFU arc spectrum. It performs bad pixel masking,
dark/bias subtraction, and flat-fielding.

The locations of the slices and the approximate shifts that should be 
applied to them are obtained from calibration files and written into the
header of the file by _LOCATE_SLICES_. These are used by _EXTRACT_SLICES_
to extract the slices and put them into another 2d image in the correct
order (the order in which they cover the 2d field of view) and 
approximately aligned in the spectral axis. 

The Figaro IARC task is used to obtain a wavelength calibration for each
row, which is filed with the calibration system for use by subsequent 
primitives. Finally all the rows are scrunched to a common, linear 
wavelength scale to allow the observer to check that the wavelength 
calibration was correct (ie that the spectra are now straight). 

=head1 Notes

=over 4

=item * 

The variance array should be propagated through the pipeline.

=item *

Bad pixels are filled before any resampling to prevent them spreading.

=back

=head1 Authors

Stephen P. Todd (Edinburgh University/UKATC)

=head1 Copyright

Copyright (C) 1998-2002 Particle Physics and Astronomy Research
Council.  All Rights Reserved.

=cut
