=head1 Name

SOURCE_WITH_NOD_TO_BLANK_SKY

Reduce a group of sky-object pairs of IFU frames.

=head1 Description

This recipe produces a coadded, sky-subtracted, wavelength calibrated,
flux calibrated datacube from a group of SKY-OBJECT pairs of IFU
frames.

Read-noise and poisson variances are added to the frame and a bad
pixel mask is applied. The spectrum from each slice of the IFU is cut
out of the frame and pasted in a new frame in such a way that there
are no longer spaces between the spectra, the spectra are arranged in
the order in which they appear in the field of view and they are
approximately aligned in the dispersion direction. The spectrum is
flat-fielded and the wavelength calibration measured from the arc
spectrum is used to apply a common, linear wavelength scale to each
row of the the 2d spectrum.

Sky-object pairs are now subtracted, and the resulting frame is
rearranged to form a data-cube, which is coadded to the group. The
spectral dimension of the data-cube is divided by the standard star
spectrum and flux calibrated. Images can be extracted over a range of
wavelengths specified in a file called extract.images placed in the
$ORAC_DATA_OUT directory, and can be displayed by editing the disp.dat
file.

=head1 Notes

=over 4

=item *

A suitable flat-field spectrum, arc spectrum and standard star
spectrum should previously have been reduced and filed with the
calibration system.

=item *

The spectra from each slice of the IFU are located using a static
look-up table giving their relative positions and a vertical shift
which should have been measured from the flat-field image.

=item *

It is essential that the observation types of the observations are set
to OBJECT and SKY as appropriate. 

=item *

A variant of this recipe, SOURCE_WITH_NOD_TO_BLANK_SKY_NOSTD, is
available which does not divide the spectrum by a standard star or
flux calibrate the spectrum. It may be useful to specify this recipe
on the command line when running ORAC-DR if you choose to defer
observation of your standard until after you have observed your
object.

=item *

Adapted from a spectroscopy recipe, and uses spectroscopy primitives.

=back

=head1 Authors

Stephen Todd <spt@roe.ac.uk>, Paul Hirst <p.hirst@jach.hawaii.edu>


=head1 Copyright

Copyright (C) 1998-2002 Particle Physics and Astronomy Research
Council. All Rights Reserved.

=cut

_REDUCE_SINGLE_FRAME_ NOARC=1 NOCUBE=1
_PAIRWISE_GROUP_

_DIVIDE_BY_STANDARD_

_SPECTROSCOPY_MODE_
_FLUX_CALIBRATE_
_IFU_MODE_

_DELETE_TEMP_FILES_ KEEP=_scr,_cub,_im,_ff
