# SKY_FLAT    -*-perl-*-
#
# Recipe to make a sky flat from a series of object frames (these may
# include blank sky) combined using one of a selection of statistics.
# It expects one dark frame followed by n object frames.
#
# It performs a null debiassing, bad-pixel masking, and dark subtraction
# before combining normalised frames pixel by pixel using a clipped
# median statistic.  The clipping comprises three rejections at two
# sigma.

# Startup
# =======
#
# Every recipe must do this.
    _UFTI_HELLO_

# This gets done for the first frame in sequence
    _SKY_FLAT_HELLO_

# Set up steering control of the processing, namely when to make a flat.
# Here assume that the jitter is 5.  Will make flat at fifth.
    _SKY_FLAT_STEER_ NUMBER=5

# Calibration
# ===========
#
# The following operations are preformed for every appropriate frame.

# Apply the bad pixel mask.
    _MASK_BAD_PIXELS_

# Remove the bias.
    _REMOVE_BIAS_

# Subtract the dark frame.
    _SUBTRACT_DARK_

# Form flat field
# ===============

# This is only done one there are at least three object frames.
    _MAKE_FLAT_FROM_GROUP_

# Remove intermediate data files.
    _DELETE_TEMP_FILES_ KEEP=_dk,_ff
