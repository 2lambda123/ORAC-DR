#+
# Name:
#    QUADRANT_JITTER_NO_MASK_TELE

# Purpose:
#     "Quadrant Jitter" standard reduction without object masking
#     and registered using telescope offsets.

# Language:
#    Perl5

# Description:
#    This script reduces a "quadrant jitter" photometry observation
#    with UFTI data.  It takes an UFTI observation comprising one or
#    more series of four object frames where the target is
#    approximately centred in each quadrant; and a dark frame to make
#    a calibrated, untrimmed mosaic automatically.

#    It performs bad-pixel masking, null debiassing, dark subtraction,
#    flat-field creation and division, registration using telescope
#    offsets, and resampling.

#    This recipe is suitable for faint objects or objects within
#    a comparatively bright core embedded in faint extended emission,
#    e.g. a quasar.  If there are other objects of comparable
#    brightness to the principal target in other quadrants, they will
#    introduce artifacts into the flat field.  Use QUADRANT_JITTER for
#    those.

# Notes: 
#    -  The bad pixel mask applied is $ORAC_DATA_CAL/bpm.
#    -  The flat field is created in two steps.  The quadrant
#    containing the object is masked in each object frame.  Then the
#    recipe combines the normalised and quadrant-masked object frames
#    using the median at each pixel.
#    -  Registration is performed using the telescope offsets
#    transformed to pixels.
#    -  The resampling applies non-integer shifts of origin using
#    bilinear interpolation.  There is no rotation to align the
#    Cartesian axes with the cardinal directions.
#    -  The recipe makes the mosaics by applying offsets in intensity
#    to give the most consistent result amongst the overlapping regions.
#    The mosaic is not trimmed to the dimensions of a single frame.  Thus
#    the noise will be greater in the peripheral areas having received
#    less exposure time.  The full signal will be in the central ninth
#    containing the main object.
#    -  For each cycle of four, the recipe creates a mosaic, which has
#    its bad pixels filled and is then co-added into a master mosaic of
#    improving signal to noise.
#    -  Intermediate frames are deleted except for the flat-fielded (_ff
#    suffix) frames.

# Output Data:
#    -  The integrated mosaic in g<date>_<group_number>_mos.
#    -  A mosaic for each cycle of four in
#    g<date>_<group_number>_mos_<cycle_number>, where <cycle_number>
#    counts from 0.
#    -  The individual flat-fielded frames in f<date>_<obs_number>_ff.
#    -  The created flat fields in flat_<group_number>subgrp for the
#    first or only cycle, and flat_<group_number>subgrp_<cycle_number>
#    for subsequent cycles.

# Timing:
#    {timing_information}

# Implementation Status:
#    -  The processing engines are from the Starlink packages: CCDPACK
#    and KAPPA.
#    -  Uses the Starlink NDF format.
#    -  History is recorded within the data files.
#    -  The title of the data is propagated through intermediate files
#    to the mosaic.
#    -  Error propagation is not used.

# Related Recipes:
#    QUADRANT_JITTER, QUADRANT_JIITER_BASIC, QUADRANT_JITTER_NO_MASK,
#    QUADRANT_JITTER_TELE, EXTENDED_5x5, EXTENDED_5x5_BASIC.

# References:
#    "Scripts for UFTI" G.S. Wright & S.K. Leggett, 1997 orac009-ufts, v01.

# Authors:
#    MJC: Malcolm J. Currie (UKATC/JAC)

# Copyright:
#    Copyright (C) 1998-2000 Particle Physics and Astronomy Research
#    Council.  All Rights Reserved.
#
#-

# Startup
# =======
#
# Every recipe must do this.
    _UFTI_HELLO_

# Recipe-specific initialisation.
    _QUADRANT_JITTER_HELLO_

# Set up steering control of the processing, namely when to make a flat, 
# make a mosaic, and to specify the reference frame for normalisation.
    _QUADRANT_JITTER_STEER_

# Calibration
# ===========
#
# The following operations are performed for every appropriate frame.

# Apply the bad pixel mask.
    _MASK_BAD_PIXELS_

# Remove the bias.
    _REMOVE_BIAS_

# Subtract the dark frame.
    _SUBTRACT_DARK_

# Generate the flat field using the quadrant-jitter technique.  Apply
# it.  No object masking is applied.
    _FLAT_FIELD_QUADRANT_JITTER_ MASK=0

# Mosaicking
# ==========

# Register the frames using a shift of pixel origin derived from the
# telescope offsets.
    _GENERATE_OFFSETS_QUADRANT_JITTER_ TELEOFF=1

# Resample each frame, and tesselate single-cycle mosaic.  The mosaic is
# untrimmed to the dimensions of an input frame.  Co-add a single-cycle
# mosaic into the main mosaic, which is initially formed using the first
# single-cycle mosaic.  Fill bad pixels by interpolation.
    _MAKE_MOSAIC_QUADRANT_OPTIMISED_ RESAMPLE=1 INT_METHOD=linint FILLBAD=1

# Remove intermediate data files.
    _QUADRANT_JITTER_TIDY_

# Podule
# ======

=head1 NAME

QUADRANT_JITTER_NO_MASK_TELE -- "Quadrant Jitter" standard reduction without object masking, and registered using telescope offsets.

=head1 LANGUAGE

Perl5

=head1 DESCRIPTION

This script reduces a "quadrant jitter" photometry observation
with UFTI data.  It takes an UFTI observation comprising one or
more series of four object frames where the target is
approximately centred in each quadrant; and a dark frame to make
a calibrated, untrimmed mosaic automatically.

It performs bad-pixel masking, null debiassing, dark subtraction,
flat-field creation and division, registration using telescope
offsets, and resampling.

This recipe is suitable for faint objects or objects within
a comparatively bright core embedded in faint extended emission,
e.g. a quasar.  If there are other objects of comparable
brightness to the principal target in other quadrants, they will
introduce artifacts into the flat field.  Use QUADRANT_JITTER for
those.

=head1 NOTES 

=over 4

=item *

The bad pixel mask applied is F<$ORAC_DATA_CAL/bpm>.

=item *

The flat field is created in two steps.  The quadrant containing the
object is masked in each object frame.  Then the recipe combines the
normalised and quadrant-masked object frames using the median at each
pixel.

=item *

Registration is performed using the telescope offsets
transformed to pixels.

=item *

The resampling applies non-integer shifts of origin using
bilinear interpolation.  There is no rotation to align the
Cartesian axes with the cardinal directions.

=item *

The recipe makes the mosaics by applying offsets in intensity
to give the most consistent result amongst the overlapping regions.
The mosaic is not trimmed to the dimensions of a single frame.  Thus
the noise will be greater in the peripheral areas having received
less exposure time.  The full signal will be in the central ninth
containing the main object.

=item *

For each cycle of four, the recipe creates a mosaic, which has
its bad pixels filled and is then co-added into a master mosaic of
improving signal to noise.

=item *

Intermediate frames are deleted except for the flat-fielded (_ff
suffix) frames, and the flat fields.

=back

=head1 OUTPUT DATA

=over 4

=item *

The integrated mosaic in g<date>_<group_number>_mos.

=item *

A mosaic for each cycle of four in
g<date>_<group_number>_mos_<cycle_number>, where <cycle_number>
counts from 0.

=item *

The individual flat-fielded frames in f<date>_<obs_number>_ff.

=item *

The created flat fields in flat_<group_number>subgrp for the first or
only cycle, and flat_<group_number>subgrp_<cycle_number> for
subsequent cycles.

=back

=head1 TIMING

TBS

=head1 IMPLEMENTATION STATUS

=over 4

=item *

The processing engines are from the Starlink packages: CCDPACK and
KAPPA.

=item *

Uses the Starlink NDF format.

=item *

History is recorded within the data files.

=item *

The title of the data is propagated through intermediate files
to the mosaic.

=item *

Error propagation is not used.

=back

=head1 RELATED RECIPES

L<QUADRANT_JITTER>, L<QUADRANT_JITTER_BASIC>, <QUADRANT_JITTER_NO_MASK>, 
L<QUADRANT_JITTER_TELE>, L<EXTENDED_5x5>, L<EXTENDED_5x5_BASIC>.

=head1 REFERENCES

"I<Scripts for UFTI>" G.S. Wright & S.K. Leggett, 1997 orac009-ufts, v01.

=head1 AUTHORS

Malcolm J. Currie (UKATC/JAC) (mjc@jach.hawaii.edu)

=head1 COPYRIGHT

Copyright (C) 1998-2000 Particle Physics and Astronomy Research
Council.  All Rights Reserved.

=cut
