#+
# Name:
#    FOCUS_RUN

# Purpose:
#    Evaluates various statistics of the point-source function.

# Language:
#    Perl5

# Description:
#    This recipe derives a selection of statistics describing
#    the light distribution within an image of a point-source.
#    It both reports and logs the statistics.  The recipe is usually
#    run on a series of images at different focus positions, from
#    which the optimum focus can be inferred.  See the notes
#    for a list of the statistics, and those recommended for
#    estimating the best focus.

#    It performs bad-pixel masking, null debiassing, and dark
#    subtraction before computing the statistics.

# Notes:
#    -  The statistics are: the Strehl; Strehl width; the diameters
#    containing 50% and 80% of the flux; the FWHM from fitting to
#    a Gaussian-like function (see KAPPA/PSF) where the exponent not
#    fixed to be 2, the fitted exponent, axis ratio, and position angle;
#    the FWHM after a Hanning smoothing filter is applied; the FWHM
#    of the core and the core diameter (usually 5 pixels).  The
#    recommended statistic for focussing is Strehl, but also 80%-flux
#    diameter and the smoothed FWHM give reasonable reliable results.
#    -  The photometry tabulation also includes the UT date and time,
#    focus position, filter and airmass.  There are headings at the top
#    of each column.
#    -  Further details can be found in the primitive _SEEING_STATISTICS_.
#    -  The log file uses the Starlink Small Text List (STL) format
#    (SUN/190).
#    -  The bad pixel mask applied is $ORAC_DATA_CAL/bpm.
#    -  Intermediate frames are deleted.
#    -  Sub-arrays are supported.

# Output Data:
#    -  The log file $ORAC_DATA_OUT/focus_run.txt.  It is created with
#    STL description and column headings, if it does not exist.
#    Otherwise the results are appended to this file.

# Timing:
#    {timing_information}

# Implementation Status:
#    -  The processing engines are from the Starlink packages: CCDPACK
#    and KAPPA.
#    -  Uses the Starlink NDF format.
#    -  Error propagation is not used.

# References:
#    "Scripts for UFTI" G.S. Wright & S.K. Leggett, 1997 orac009-ufts, v01.

# Authors:
#    MJC: Malcolm J. Currie (UKATC/JAC)
#
#-

# Startup
# =======
#
# Every recipe must do this.
    _UFTI_HELLO_

# Recipe-specific initialisation.
    _FOCUS_RUN_HELLO_

# Set up steering control of the processing.
#    _FOCUS_RUN_STEER_

# Calibration
# ===========
#
# Apply the bad pixel mask.
    _MASK_BAD_PIXELS_

# Remove the bias.
    _REMOVE_BIAS_

# Subtract the dark frame.
    _SUBTRACT_DARK_

# Flat field using a pre-existing calibration frame.
#    _DIVIDE_BY_FLAT_

# Statistics
# ==========

# Create a text catalogue, if it doesn't already exist.  Perform statistics.
    _SEEING_STATISTICS_ FILE=focus_run.txt

# Remove intermediate data files.
    _FOCUS_RUN_TIDY_

# Podule
# ======

=head1 NAME

FOCUS_RUN -- Evaluates various statistics of the point-source function.

=head1 LANGUAGE

Perl5

=head1 DESCRIPTION

This recipe derives a selection of statistics describing
the light distribution within an image of a point-source.
It both reports and logs the statistics.  The recipe is usually
run on a series of images at different focus positions, from
which the optimum focus can be inferred.  See the notes
for a list of the statistics, and those recommended for
estimating the best focus.

It performs bad-pixel masking, null debiassing, and dark
subtraction before computing the statistics.

=head1 NOTES

=over 4

=item *

The statistics are: the Strehl; Strehl width; the diameters
containing 50% and 80% of the flux; the FWHM from fitting to
a Gaussian-like function (see KAPPA/PSF) where the exponent not
fixed to be 2, the fitted exponent, axis ratio, and position angle;
the FWHM after a Hanning smoothing filter is applied; the FWHM
of the core and the core diameter (usually 5 pixels).  The
recommended statistic for focussing is Strehl, but also 80%-flux
diameter and the smoothed FWHM give reasonable reliable results.

=item *

The photometry tabulation also includes the UT date and time,
focus position, filter and airmass.  There are headings at the top
of each column.

=item *

Further details can be found in the primitive L<_SEEING_STATISTICS_>.

=item *

The log file uses the Starlink Small Text List (STL) format
(SUN/190).

=item *

The bad pixel mask applied is $ORAC_DATA_CAL/bpm.

=item *

Intermediate frames are deleted.

=item *

Sub-arrays are supported.

=back

=head1 OUTPUT DATA

=over 4

=item *

The log file F<$ORAC_DATA_OUT/focus_run.txt>.  It is created with
STL description and column headings, if it does not exist.
Otherwise the results are appended to this file.

=back

=head1 TIMING

TBS

=head1 IMPLEMENTATION STATUS

=over 4

=item *

The processing engines are from the Starlink packages: CCDPACK
and KAPPA.

=item *

Uses the Starlink NDF format.

=item *

Error propagation is not used.

=back

=head1 REFERENCES

"I<Scripts for UFTI>" G.S. Wright & S.K. Leggett, 1997 orac009-ufts, v01.

=head1 AUTHORS

Malcolm J. Currie (UKATC/JAC)

=cut
