#!/bin/perl
#
# Really, *really* wipe out all CGS4DR-related processes, files and pipes
#
# HILO version, offline only
#                                                                            (Frossie - 17/5/96)
#

require "find.pl";
 
#

open(LOG,">> /ukirt_sw/logs/cgs4dr_nuke.log");
chop($date = `/usr/bin/date`);
chop($machine = `/usr/ucb/hostname`);
print LOG "$date by $ENV{'USER'} on $machine\n";


&proc_kill("awish|atclsh");
#&proc_kill("cgs4dr");
&proc_kill("qman");&proc_kill("p4");&proc_kill("cred4");&proc_kill("red4");
&ipcs_kill;
# &proc_kill("adamnet");
#
chdir();
&find('adam');
#
print "\t\tcgs4dr_nuke-  Ok: It's probably dead Jim.\n";
print "Now type cgs4dr_dev to run up the software again\n";
exit;
 
sub wanted {
    (($dev,$ino,$mode,$nlink,$uid,$gid) = lstat($_)) &&
    -p _ &&
    (unlink($_) || warn "$name: $!\n");
}

sub proc_kill {

    local($ps) = @_;

    @processes = `/usr/ucb/ps -axw`;

    foreach (@processes) {

	@a = split;

	($a[4] =~ /$ps/) && do {kill 'KILL',$a[0]};

    }

}


sub ipcs_kill {

    @ipcs = `/usr/bin/ipcs`;

    foreach (@ipcs) {

	@a = split;

	($a[4]=~ $ENV{"USER"}) && do {system("ipcrm -m $a[1]")};

     }


    }

				 

